schema: '2.0'
stages:
  ingest_kaggle:
    cmd: "python scripts/data_ingestion/descarga_kaggle_reviews.py --out data/landing/sephora/raw\n"
    deps:
    - path: scripts/data_ingestion/descarga_kaggle_reviews.py
      hash: md5
      md5: e27b06cc672ef4f0b2347bf61ccb6322
      size: 762
    outs:
    - path: data/landing/sephora/raw
      hash: md5
      md5: 8b7019941c39ea0d57fae739d69994b5.dir
      size: 528949733
      nfiles: 6
  conversion_a_delta:
    cmd: "python scripts/data_cleaning/conversion_a_delta.py --input data/landing/sephora/raw
      --output data/landing/sephora/delta\n"
    deps:
    - path: data/landing/sephora/raw
      hash: md5
      md5: 8b7019941c39ea0d57fae739d69994b5.dir
      size: 528949733
      nfiles: 6
    - path: scripts/data_cleaning/conversion_a_delta.py
      hash: md5
      md5: f2e92a0eb8508d5d7f9f8543545af804
      size: 1737
    outs:
    - path: data/landing/sephora/delta
      hash: md5
      md5: 55a7b5a693bd0ed52f0c1608c6c9cd7e.dir
      size: 230118963
      nfiles: 172
  trusted_clean_driver:
    cmd: "python scripts/data_cleaning/trusted_clean_driver.py --input  data/landing/sephora/delta
      --output data/trusted/sephora_clean\n"
    deps:
    - path: data/landing/sephora/delta
      hash: md5
      md5: 0e40bd239d8164baa8d31fdb702b9c3b.dir
      size: 230119217
      nfiles: 172
    - path: scripts/data_cleaning/trusted_clean_driver.py
      hash: md5
      md5: 12fb524919587f142c3e2d8a0b638787
      size: 805
    - path: scripts/data_cleaning/trusted_clean_single.py
      hash: md5
      md5: e9f9c94752272c42f4c257b369e68e8b
      size: 4336
    outs:
    - path: data/trusted/sephora_clean/product_info
      hash: md5
      md5: c905a19719f033ddccec1a68bcef2ad7.dir
      size: 2837914
      nfiles: 10
    - path: data/trusted/sephora_clean/reviews_0_250
      hash: md5
      md5: 716b3b37465f3d6ee1231068c7f3dd4d.dir
      size: 267928038
      nfiles: 48
    - path: data/trusted/sephora_clean/reviews_1250_end
      hash: md5
      md5: 6e72c1d952c2195505ed3c10d719671a.dir
      size: 24234532
      nfiles: 48
    - path: data/trusted/sephora_clean/reviews_250_500
      hash: md5
      md5: 651412b39ced08b32f61ddaf40fdd62b.dir
      size: 95799300
      nfiles: 48
    - path: data/trusted/sephora_clean/reviews_500_750
      hash: md5
      md5: eb75b90c288a3e12ae4f23bd3f9d969a.dir
      size: 54040580
      nfiles: 48
    - path: data/trusted/sephora_clean/reviews_750_1250
      hash: md5
      md5: 4b19340bdf86d8690d11600f086387b8.dir
      size: 56044298
      nfiles: 48
  merge_trusted_reviews:
    cmd: "python scripts/data_cleaning/merge_trusted_reviews.py --input-dir data/trusted/sephora_clean
      --output    data/trusted/reviews_full --format delta --coalesce  64\n"
    deps:
    - path: data/trusted/sephora_clean/product_info
      hash: md5
      md5: 3577e02353a591c15b8c577aa684ab64.dir
      size: 2837914
      nfiles: 10
    - path: data/trusted/sephora_clean/reviews_0_250
      hash: md5
      md5: cbb8686a5ddcda1718e9e769dec402a7.dir
      size: 267928038
      nfiles: 48
    - path: data/trusted/sephora_clean/reviews_1250_end
      hash: md5
      md5: 8072752805ff8578438714cb65f5610e.dir
      size: 24234532
      nfiles: 48
    - path: data/trusted/sephora_clean/reviews_250_500
      hash: md5
      md5: 7151dafb09764812dc79b98df3e62c73.dir
      size: 95799300
      nfiles: 48
    - path: data/trusted/sephora_clean/reviews_500_750
      hash: md5
      md5: b06b5bcc8f0cfb1cdf76e71e6b3bfbd1.dir
      size: 54040580
      nfiles: 48
    - path: data/trusted/sephora_clean/reviews_750_1250
      hash: md5
      md5: 2724f4e3837f8d9111976fa0d05fa6db.dir
      size: 56044298
      nfiles: 48
    - path: scripts/data_cleaning/merge_trusted_reviews.py
      hash: md5
      md5: 328357b16b26547e2b06709acb583b63
      size: 5557
    outs:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 4485207d96ba5a6d739a8b5570c6df6d.dir
      size: 495378510
      nfiles: 18
  eda_full:
    cmd: "python scripts/EDA/eda_reviews.py --input data/trusted/reviews_full --outdir
      reports/eda/full --tokenizer albert-base-v2\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 4485207d96ba5a6d739a8b5570c6df6d.dir
      size: 495378510
      nfiles: 18
    - path: params.yaml
      hash: md5
      md5: 3322653cf5ce2b5dc6494dde8d8a6dde
      size: 2207
    - path: scripts/EDA/eda_reviews.py
      hash: md5
      md5: 6235ecad747eb664623c25c539bb2a67
      size: 10430
    outs:
    - path: reports/eda/full
      hash: md5
      md5: 468d72acb76f922c40ea44be303550ea.dir
      size: 91181
      nfiles: 10
  sample_reviews:
    cmd: "python scripts/data_cleaning/sample_reviews.py --input data/trusted/reviews_full
      --output data/trusted/reviews_sample_30pct --frac 0.30 --by labels --seed 42\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 08549c8975b204736b6d85c1bb6a55a8.dir
      size: 493840996
      nfiles: 18
    - path: scripts/data_cleaning/sample_reviews.py
      hash: md5
      md5: b53be00c693d1b0eca07a1c53acbfe64
      size: 3658
    outs:
    - path: data/trusted/reviews_sample_30pct
      hash: md5
      md5: 2f4abe9eececec8710ea87937d163ea7.dir
      size: 148792281
      nfiles: 18
  eda_sample:
    cmd: python scripts/EDA/eda_reviews.py --input 
      data/trusted/reviews_sample_30pct --outdir reports/eda/sample_30pct 
      --tokenizer albert-base-v2
    deps:
    - path: data/trusted/reviews_sample_30pct
      hash: md5
      md5: 2f4abe9eececec8710ea87937d163ea7.dir
      size: 148792281
      nfiles: 18
    - path: params.yaml
      hash: md5
      md5: 1cc224cc01c4ed14dd211f948a3e9977
      size: 1052
    - path: scripts/EDA/eda_reviews.py
      hash: md5
      md5: 6235ecad747eb664623c25c539bb2a67
      size: 10430
    outs:
    - path: reports/eda/sample_30pct
      hash: md5
      md5: f00407d91fdf27502b34286c503e82a3.dir
      size: 88768
      nfiles: 10
  eda_compare_full_vs_sample_30pct:
    cmd: python scripts/EDA/eda_compare.py --full reports/eda/full --sample 
      reports/eda/sample_30pct --outdir reports/eda/compare_full_vs_sample_30pct
    deps:
    - path: reports/eda/full
      hash: md5
      md5: 7bf3ddaa898dd7f5fd79c27084c2c550.dir
      size: 91160
      nfiles: 10
    - path: reports/eda/sample_30pct
      hash: md5
      md5: f00407d91fdf27502b34286c503e82a3.dir
      size: 88768
      nfiles: 10
    - path: scripts/EDA/eda_compare.py
      hash: md5
      md5: ccbfd0ac430439ce9b8480693f4f6702
      size: 6597
    outs:
    - path: reports/eda/compare_full_vs_sample_30pct
      hash: md5
      md5: ac22c9f240eab39a98b6d5ffa5db78a9.dir
      size: 6506
      nfiles: 7
  split_train_val_test:
    cmd: "python scripts/training/prepare_test_parquet.py --input  data/trusted/reviews_sample_30pct
      --outdir data/exploitation/modelos_input/sample_tvt --seed 42\n"
    deps:
    - path: data/trusted/reviews_sample_30pct
      hash: md5
      md5: 3c913bd98909183982d0cc53110a1da0.dir
      size: 143121002
      nfiles: 50
    - path: params.yaml
      hash: md5
      md5: 3322653cf5ce2b5dc6494dde8d8a6dde
      size: 2207
    - path: scripts/training/prepare_test_parquet.py
      hash: md5
      md5: 347ee9d1a01887aea96a63ae36cad088
      size: 4478
    outs:
    - path: data/exploitation/modelos_input/sample_tvt
      hash: md5
      md5: 0c9a7ed18242b33b7c2e73ba250ce80f.dir
      size: 141534125
      nfiles: 3
  train_albert_sample:
    cmd: "MLFLOW_RUN_NAME=albert_sample_30pct python scripts/training/train_albert_from_parquets.py
      --train data/exploitation/modelos_input/sample_tvt/train --val   data/exploitation/modelos_input/sample_tvt/val
      --model-out models/albert_sample_30pct --params params.yaml\n"
    deps:
    - path: data/exploitation/modelos_input/sample_tvt/train
      hash: md5
      md5: 9209563c84f500f95462c3c20a78aaf0.dir
      size: 106044050
      nfiles: 1
    - path: data/exploitation/modelos_input/sample_tvt/val
      hash: md5
      md5: 3897382c33dacb582249c542f7c79759.dir
      size: 14238818
      nfiles: 1
    - path: params.yaml
      hash: md5
      md5: 3322653cf5ce2b5dc6494dde8d8a6dde
      size: 2207
    - path: scripts/training/train_albert_from_parquets.py
      hash: md5
      md5: abf0b5fb9563be466a538cf21764d5ad
      size: 31872
    outs:
    - path: models/albert_sample_30pct
      hash: md5
      md5: 923ed8e16d5c6e248094aff1bf38c3cf.dir
      size: 49784962
      nfiles: 8
  evaluate_albert_sample:
    cmd: "PYTHONNOUSERSITE=1 TRANSFORMERS_NO_TF=1 TRANSFORMERS_NO_JAX=1 USE_TF=0 USE_JAX=0
      /home/pedro/MASTER_BIGDATA/venv/bin/python scripts/training/evaluate_albert.py
      --model_dir models/albert_sample_30pct --test_parquet data/exploitation/modelos_input/sample_tvt/test
      --output_dir reports/albert_sample_30pct/eval\n"
    deps:
    - path: data/exploitation/modelos_input/sample_tvt/test
      hash: md5
      md5: bfa024e0523b5306f46976ba7d064f60.dir
      size: 21251257
      nfiles: 1
    - path: models/albert_sample_30pct
      hash: md5
      md5: 923ed8e16d5c6e248094aff1bf38c3cf.dir
      size: 49784962
      nfiles: 8
    - path: scripts/training/evaluate_albert.py
      hash: md5
      md5: 65666831a43b30e2c23a14ae56ac6214
      size: 10535
    outs:
    - path: reports/albert_sample_30pct/eval
      hash: md5
      md5: ff2869b28cd6b9e7c4e6e5fe3b5bd671.dir
      size: 2837721
      nfiles: 6
  train_albert:
    cmd: "python scripts/training/train_albert_from_parquets.py --train data/trusted/splits/train
      --val   data/trusted/splits/val --model-out models/albert_sample_30pct --params
      params.yaml\n"
    deps:
    - path: data/trusted/splits/train
      hash: md5
      md5: 65af6292cf6401a314390f0de62fc38a.dir
      size: 64893152
      nfiles: 18
    - path: data/trusted/splits/val
      hash: md5
      md5: fc3b1f9f978117ee50cd4c007fb2a2ae.dir
      size: 28380878
      nfiles: 18
    - path: params.yaml
      hash: md5
      md5: 5a9b64da1df3b206ebc3bf5bef6d42f3
      size: 3061
    - path: scripts/training/train_albert_from_parquets.py
      hash: md5
      md5: 26a546ff762a2c400ba78a867913b983
      size: 22305
    outs:
    - path: models/albert_sample_30pct
      hash: md5
      md5: c45f462a87128665e61a6c2fa9967281.dir
      size: 386202977
      nfiles: 35
  infer_albert_all:
    cmd: "python scripts/training/infer_albert_all.py --model_dir models/albert_sample_30pct
      --input_parquet data/trusted/reviews_full --output_parquet reports/albert_sample_30pct/infer/predictions.parquet
      --eval_output_dir reports/albert_sample_30pct/infer_eval_full --text_col review_text_clean
      --id_col review_id --label_col label --max_length 192 --batch_size 256 --labels
      negative neutral positive\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 660f5d166d2f7ad288ca7729c8deb3e9.dir
      size: 495606028
      nfiles: 24
    - path: models/albert_sample_30pct
      hash: md5
      md5: d71a6277af2ec5b4120fa66aea0113cf.dir
      size: 49784806
      nfiles: 8
    - path: scripts/training/infer_albert_all.py
      hash: md5
      md5: 0664a8fb2bf0e4cc6dccb16a5c9ba619
      size: 10348
    params:
      params.yaml:
        infer:
          model_dir: models/albert_sample_30pct
          input_parquet: data/trusted/reviews_full
          output_parquet: reports/albert_sample_30pct/infer/predictions.parquet
          eval_output_dir: reports/albert_sample_30pct/infer_eval_full
          text_col: review_text_clean
          id_col: review_id
          label_col: label
          batch_size: 1280
          max_length: 192
    outs:
    - path: reports/albert_sample_30pct/infer/predictions.parquet
      hash: md5
      md5: 17bea98847c6a5beeef26f487a17fa5e
      size: 42520506
  trusted_sample_30:
    cmd: "python scripts/data_cleaning/sample_reviews.py --input  data/trusted/reviews_full
      --output data/trusted/reviews_sample_30pct --frac 0.3 --by sentiment_category
      --format delta --seed 42 --coalesce 64 --balance true\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 4485207d96ba5a6d739a8b5570c6df6d.dir
      size: 495378510
      nfiles: 18
    - path: scripts/data_cleaning/sample_reviews.py
      hash: md5
      md5: fd98cc639796fd46d1361d8b2fe224c3
      size: 8858
    params:
      params.yaml:
        sampling:
          frac: 0.3
          by: sentiment_category
          seed: 42
          format: delta
          coalesce: 64
          balance: true
    outs:
    - path: data/trusted/reviews_sample_30pct
      hash: md5
      md5: 3c913bd98909183982d0cc53110a1da0.dir
      size: 143121002
      nfiles: 50
  eda_sample_30:
    cmd: "python scripts/EDA/eda_reviews.py --input data/trusted/reviews_sample_30pct
      --outdir reports/eda/sample_30 --tokenizer albert-base-v2\n"
    deps:
    - path: data/trusted/reviews_sample_30pct
      hash: md5
      md5: 3c913bd98909183982d0cc53110a1da0.dir
      size: 143121002
      nfiles: 50
    - path: params.yaml
      hash: md5
      md5: 3322653cf5ce2b5dc6494dde8d8a6dde
      size: 2207
    - path: scripts/EDA/eda_reviews.py
      hash: md5
      md5: 6235ecad747eb664623c25c539bb2a67
      size: 10430
    outs:
    - path: reports/eda/sample_30
      hash: md5
      md5: 333147882034d0d369407eef0e05b054.dir
      size: 86603
      nfiles: 10
  eda_compare_full_vs_30:
    cmd: "python scripts/EDA/eda_compare.py --a data/trusted/reviews_full --b data/trusted/reviews_sample_30pct
      --outdir reports/eda/compare_full_vs_30 --by sentiment_category --input-format
      auto --tokenizer albert-base-v2 --sample-rows 120000 --max-len 128 --clip-tokens
      true --silence-tokenizer-warnings true\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 4485207d96ba5a6d739a8b5570c6df6d.dir
      size: 495378510
      nfiles: 18
    - path: data/trusted/reviews_sample_30pct
      hash: md5
      md5: 3c913bd98909183982d0cc53110a1da0.dir
      size: 143121002
      nfiles: 50
    - path: scripts/EDA/eda_compare.py
      hash: md5
      md5: 47f357297a778055cea6698a7b44810b
      size: 11381
    params:
      params.yaml:
        eda_compare_full_vs_30:
          a: data/trusted/reviews_full
          b: data/trusted/reviews_sample_30pct
          outdir: reports/eda/compare_full_vs_30
          by: sentiment_category
          input_format: auto
          tokenizer: albert-base-v2
          sample_rows: 120000
          max_len: 128
          clip_tokens: true
          silence_tokenizer_warnings: true
    outs:
    - path: reports/eda/compare_full_vs_30
      hash: md5
      md5: 05e53a4dae24edd72f181b6bb9f2b098.dir
      size: 59628
      nfiles: 24
  infer_albert_forward:
    cmd: "PYTHONNOUSERSITE=1 TRANSFORMERS_NO_TF=1 TRANSFORMERS_NO_JAX=1 USE_TF=0 USE_JAX=0
      /home/pedro/MASTER_BIGDATA/venv/bin/python scripts/training/infer_albert_all.py
      --model_dir models/albert_sample_30pct --input_parquet data/trusted/reviews_full
      --output_parquet reports/albert_sample_30pct/infer/predictions.parquet --eval_output_dir
      reports/albert_sample_30pct/infer_eval_full --text_col review_text_clean --id_col
      review_id --batch_size 128\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: aeee9d89c9d221c5a91da28ee292a39b.dir
      size: 494842050
      nfiles: 82
    - path: models/albert_sample_30pct
      hash: md5
      md5: d71a6277af2ec5b4120fa66aea0113cf.dir
      size: 49784806
      nfiles: 8
    - path: scripts/training/infer_albert_all.py
      hash: md5
      md5: 24f7a940fafa350c7ee192dba1f2969b
      size: 4038
    outs:
    - path: reports/albert_sample_30pct/infer/predictions.parquet
      hash: md5
      md5: a5fedaafa341c219fec1b6bb8c03bb76
      size: 43106181
  make_rest_from_full:
    cmd: "python scripts/data_cleaning/make_rest_from_full.py --full data/trusted/reviews_full
      --sample-root data/exploitation/modelos_input/sample_tvt --sample-delta data/trusted/reviews_sample_30pct
      --out data/exploitation/modelos_input/rest_from_full --format parquet --coalesce
      64\n"
    deps:
    - path: data/exploitation/modelos_input/sample_tvt/test
      hash: md5
      md5: bfa024e0523b5306f46976ba7d064f60.dir
      size: 21251257
      nfiles: 1
    - path: data/exploitation/modelos_input/sample_tvt/train
      hash: md5
      md5: 9209563c84f500f95462c3c20a78aaf0.dir
      size: 106044050
      nfiles: 1
    - path: data/exploitation/modelos_input/sample_tvt/val
      hash: md5
      md5: 3897382c33dacb582249c542f7c79759.dir
      size: 14238818
      nfiles: 1
    - path: data/trusted/reviews_full
      hash: md5
      md5: 4485207d96ba5a6d739a8b5570c6df6d.dir
      size: 495378510
      nfiles: 18
    - path: data/trusted/reviews_sample_30pct
      hash: md5
      md5: 3c913bd98909183982d0cc53110a1da0.dir
      size: 143121002
      nfiles: 50
    - path: scripts/data_cleaning/make_rest_from_full.py
      hash: md5
      md5: 3bb53988de3fbe6a76eed0afa4b6aede
      size: 5388
    outs:
    - path: data/exploitation/modelos_input/rest_from_full
      hash: md5
      md5: 05e873d95fec452607af14e895877784.dir
      size: 353112531
      nfiles: 20
  evaluate_albert_rest:
    cmd: "python scripts/training/evaluate_albert.py --model_dir models/albert_sample_30pct
      --test_parquet data/exploitation/modelos_input/rest_from_full --output_dir reports/albert_sample_30pct/eval_rest
      --max_len 192\n"
    deps:
    - path: data/exploitation/modelos_input/rest_from_full
      hash: md5
      md5: 3d191c7bbccd2f2fbb5de1335383c429.dir
      size: 352996248
      nfiles: 20
    - path: models/albert_sample_30pct
      hash: md5
      md5: e45ca43f22c5129254eef74a3224e7e9.dir
      size: 49784962
      nfiles: 8
    - path: scripts/training/evaluate_albert.py
      hash: md5
      md5: 65666831a43b30e2c23a14ae56ac6214
      size: 10535
    outs:
    - path: reports/albert_sample_30pct/eval_rest
      hash: md5
      md5: 6ddfbe74ecac33d052ba902bd25f3846.dir
      size: 41250955
      nfiles: 6
  infer_top50_upvoted_ulta:
    cmd: "python scripts/infer/infer_top_upvoted_ulta.py --input_delta \"data/trusted/ulta_clean/Ulta
      Skincare Reviews\" --model_dir models/albert_sample_30pct --top_n 50 --output_parquet
      reports/albert_sample_30pct/infer_top50_upvoted_ulta/predictions.parquet\n"
    deps:
    - path: data/trusted/ulta_clean/Ulta Skincare Reviews
      hash: md5
      md5: beebb92e4be0fdb3bc2b5731308aa47c.dir
      size: 3627645
      nfiles: 24
    - path: models/albert_sample_30pct
      hash: md5
      md5: 923ed8e16d5c6e248094aff1bf38c3cf.dir
      size: 49784962
      nfiles: 8
    - path: scripts/infer/infer_top_upvoted_ulta.py
      hash: md5
      md5: 5c9dc38cb146fbe6d20410672e70c6e3
      size: 10397
    outs:
    - path: reports/albert_sample_30pct/infer_top50_upvoted_ulta
      hash: md5
      md5: d75802f5892bc2910d1f23ecaa5ca57b.dir
      size: 53824
      nfiles: 12
  merge_reviews_product_info:
    cmd: "python scripts/data_cleaning/merge_reviews_product_info.py --reviews_path
      data/trusted/reviews_full --product_info_path data/trusted/sephora_clean/product_info
      --output_path data/trusted/reviews_product_info_clean_full --input_format auto
      --output_format delta --repartition 0 --coalesce 64 --product_prefix pinfo_
      --broadcast_product_info true\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 4485207d96ba5a6d739a8b5570c6df6d.dir
      size: 495378510
      nfiles: 18
    - path: data/trusted/sephora_clean/product_info
      hash: md5
      md5: 3577e02353a591c15b8c577aa684ab64.dir
      size: 2837914
      nfiles: 10
    - path: scripts/data_cleaning/merge_reviews_product_info.py
      hash: md5
      md5: 8146cb418204fc6ac7c89d9e5ef61ca9
      size: 7736
    params:
      params.yaml:
        merge_reviews_product_info.broadcast_product_info: 'true'
        merge_reviews_product_info.coalesce: 64
        merge_reviews_product_info.input_format: auto
        merge_reviews_product_info.output_format: delta
        merge_reviews_product_info.product_prefix: pinfo_
        merge_reviews_product_info.repartition: 0
        paths:
          reviews_full: data/trusted/reviews_full
          product_info: data/trusted/sephora_clean/product_info
          merged_out: data/trusted/reviews_product_info_clean_full
    outs:
    - path: data/trusted/reviews_product_info_clean_full
      hash: md5
      md5: eaadce9f929da408872e4483cfab3c5a.dir
      size: 796568875
      nfiles: 20
  gen_aspects_json:
    cmd: "python -c \"import os, json, yaml; d=yaml.safe_load(open('params.yaml'));
      os.makedirs('configs', exist_ok=True); json.dump(d['aspects_ontology_en'], open('configs/aspects_en.json','w'),
      ensure_ascii=False, indent=2)\"\n"
    deps:
    - path: params.yaml
      hash: md5
      md5: 54f6dbb1dfbb57cbad1a7f096050bd1d
      size: 5378
    params:
      params.yaml:
        aspects_ontology_en:
          fragrance:
          - fragrance
          - scent
          - smell
          - aroma
          - perfume
          - notes
          - odor
          - fragrant
          longevity:
          - longevity
          - long-lasting
          - lasting
          - wear time
          - duration
          - staying power
          sillage:
          - sillage
          - projection
          - trail
          - leaves a trail
          price:
          - price
          - price point
          - cost
          - value
          - worth
          - expensive
          - cheap
          - overpriced
          packaging:
          - packaging
          - bottle
          - cap
          - pump
          - box
          - container
          - design
          texture:
          - texture
          - consistency
          - feel
          - thick
          - thin
          - creamy
          - watery
          - sticky
          - greasy
          - lightweight
          - silky
          hydration:
          - hydration
          - moisturizing
          - hydrating
          - moisture
          - drying
          - dehydrating
          application:
          - application
          - apply
          - applies
          - spreads
          - absorbs
          - glides
          - blendability
          - easy to use
          finish:
          - finish
          - matte
          - dewy
          - glowy
          - glossy
          - sheen
          - shine
          irritation:
          - irritation
          - irritates
          - sting
          - burning
          - redness
          - itch
          - breakout
          - allergic
          - sensitivity
          ingredients:
          - ingredients
          - alcohol
          - parabens
          - sulfates
          - silicones
          - fragrance-free
          - clean
          - formula
          effectiveness:
          - effectiveness
          - works
          - results
          - performance
          - improvement
          - does nothing
    outs:
    - path: configs/aspects_en.json
      hash: md5
      md5: 1f1cbebab683cf097855ecfa9cfdecd8
      size: 1617
  build_ate_trusted:
    cmd: "python scripts/absa/build_ate_trusted_from_ontology.py --input_path data/trusted/reviews_product_info_clean_full
      --input_format delta --text_col review_text_clean --id_col review_id --ontology_json
      configs/aspects_en.json --output_dir data/trusted/ate --train_filename train.jsonl
      --valid_filename valid.jsonl --sample_fraction 0.2 --max_reviews 300000 --train_valid_split
      0.9 --keep_neg_ratio 0.2 --seed 13\n"
    deps:
    - path: configs/aspects_en.json
      hash: md5
      md5: 1f1cbebab683cf097855ecfa9cfdecd8
      size: 1617
    - path: data/trusted/reviews_product_info_clean_full
      hash: md5
      md5: eaadce9f929da408872e4483cfab3c5a.dir
      size: 796568875
      nfiles: 20
    - path: scripts/absa/build_ate_trusted_from_ontology.py
      hash: md5
      md5: 0f4076985d3d58641f55425086c1cbfd
      size: 7793
    params:
      params.yaml:
        ate_train.train_path: data/trusted/ate/train.jsonl
        ate_train.valid_path: data/trusted/ate/valid.jsonl
        ate_trusted:
          input_path: data/trusted/reviews_product_info_clean_full
          input_format: delta
          text_col: review_text_clean
          id_col: review_id
          ontology_json: configs/aspects_en.json
          output_dir: data/trusted/ate
          train_filename: train.jsonl
          valid_filename: valid.jsonl
          sample_fraction: 0.2
          max_reviews: 300000
          train_valid_split: 0.9
          keep_neg_ratio: 0.2
          seed: 13
    outs:
    - path: data/trusted/ate/train.jsonl
      hash: md5
      md5: 72845fb98ed2c103ebbe5fad193f2d48
      size: 132839940
    - path: data/trusted/ate/valid.jsonl
      hash: md5
      md5: 95deb7ccc458567f8a729cd58713922d
      size: 14739976
  train_ate_bio:
    cmd: "python scripts/absa/train_ate_bio.py --train_path data/trusted/ate/train.jsonl
      --valid_path data/trusted/ate/valid.jsonl --model_name roberta-base --output_dir
      models/ate_roberta_base --epochs 4 --lr 2e-05 --batch_size 32 --grad_accum 2
      --max_length 192 --fp16 false --bf16 true --grad_checkpoint false --dataloader_workers
      8\n"
    deps:
    - path: data/trusted/ate/train.jsonl
      hash: md5
      md5: 72845fb98ed2c103ebbe5fad193f2d48
      size: 132839940
    - path: data/trusted/ate/valid.jsonl
      hash: md5
      md5: 95deb7ccc458567f8a729cd58713922d
      size: 14739976
    - path: scripts/absa/train_ate_bio.py
      hash: md5
      md5: 2d388cccc6f6208197038b4dec501bbb
      size: 9197
    params:
      params.yaml:
        ate_train:
          model_name: roberta-base
          output_dir: models/ate_roberta_base
          epochs: 4
          lr: 2e-05
          batch_size: 32
          grad_accum: 2
          max_length: 192
          fp16: false
          bf16: true
          grad_checkpoint: false
          dataloader_workers: 8
          train_path: data/trusted/ate/train.jsonl
          valid_path: data/trusted/ate/valid.jsonl
    outs:
    - path: models/ate_roberta_base
      hash: md5
      md5: 217673fb8b498315510c12975c5f563c.dir
      size: 1994821249
      nfiles: 20
  infer_ate_spans:
    cmd: "python scripts/absa/infer_ate_spans.py --model_dir models/ate_roberta_base
      --input_path data/trusted/reviews_product_info_clean_full --input_format delta
      --text_col review_text_clean --id_col review_id --output_parquet reports/absa/ate_spans.parquet
      --max_length 192 --batch_size 128 --flush_rows 25000\n"
    deps:
    - path: data/trusted/reviews_product_info_clean_full
      hash: md5
      md5: eaadce9f929da408872e4483cfab3c5a.dir
      size: 796568875
      nfiles: 20
    - path: models/ate_roberta_base
      hash: md5
      md5: 217673fb8b498315510c12975c5f563c.dir
      size: 1994821249
      nfiles: 20
    - path: scripts/absa/infer_ate_spans.py
      hash: md5
      md5: b57c3d9890578e13d1eac09d51759be9
      size: 12960
    params:
      params.yaml:
        ate_infer:
          model_dir: models/ate_roberta_base
          input_path: data/trusted/reviews_product_info_clean_full
          input_format: delta
          text_col: review_text_clean
          id_col: review_id
          output_parquet: reports/absa/ate_spans.parquet
          max_length: 192
          batch_size: 128
          flush_rows: 25000
    outs:
    - path: reports/absa/ate_spans.parquet
      hash: md5
      md5: de6928cf97aec2601266f1c3f7cf6f39
      size: 40279059
  map_ate_spans:
    cmd: "python scripts/absa/map_spans_to_ontology.py --spans_parquet reports/absa/ate_spans.parquet
      --ontology_json configs/aspects_en.json --output_parquet reports/absa/ate_spans_mapped.parquet
      --threshold 0.45\n"
    deps:
    - path: configs/aspects_en.json
      hash: md5
      md5: 1f1cbebab683cf097855ecfa9cfdecd8
      size: 1617
    - path: reports/absa/ate_spans.parquet
      hash: md5
      md5: de6928cf97aec2601266f1c3f7cf6f39
      size: 40279059
    - path: scripts/absa/map_spans_to_ontology.py
      hash: md5
      md5: 2a66e66e776129c17888700ec3fec240
      size: 3146
    params:
      params.yaml:
        ate_map:
          spans_parquet: reports/absa/ate_spans.parquet
          ontology_json: configs/aspects_en.json
          output_parquet: reports/absa/ate_spans_mapped.parquet
          threshold: 0.45
    outs:
    - path: reports/absa/ate_spans_mapped.parquet
      hash: md5
      md5: 6c9a99ed713accecd123221adaf1cb7e
      size: 35793367
  absa_build_all:
    cmd: "python scripts/absa/build_absa_dataset.py --spans_parquet reports/absa/ate_spans.parquet
      --map_parquet   reports/absa/ate_spans_mapped.parquet --sentiment_parquet reports/albert_sample_30pct/infer_full_pandas/predictions.parquet
      --id_col review_id --span_text_col aspect_span --category_col aspect_norm --sentiment_col
      pred_3 --output_dir reports/absa/final_all\n"
    deps:
    - path: params.yaml
      hash: md5
      md5: 8465281c1d6fce48d43dd12b939f12c9
      size: 5766
    - path: reports/absa/ate_spans.parquet
      hash: md5
      md5: de6928cf97aec2601266f1c3f7cf6f39
      size: 40279059
    - path: reports/absa/ate_spans_mapped.parquet
      hash: md5
      md5: 6c9a99ed713accecd123221adaf1cb7e
      size: 35793367
    - path: reports/albert_sample_30pct/infer_full_pandas/predictions.parquet
      hash: md5
      md5: 16152215958df9193ea75fcc01d43017
      size: 57337966
    - path: scripts/absa/build_absa_dataset.py
      hash: md5
      md5: 37777cd65e975fafb0adb50ead1c0e9e
      size: 17156
    outs:
    - path: reports/absa/final_all
      hash: md5
      md5: 9c2a5bdf2610b5a8f05dff941a6c95ee.dir
      size: 33218869
      nfiles: 77
  absa_eval_thr90:
    cmd: "python scripts/absa/metrics_from_predictions.py --predictions_parquet reports/albert_sample_30pct/eval/predictions.parquet
      --out_dir reports/absa/phase2_eval_thr90 --neutral_threshold 0.90\n"
    deps:
    - path: reports/albert_sample_30pct/eval/predictions.parquet
      hash: md5
      md5: 87938fb8ebe761a3cf982fb371a7cd71
      size: 2781658
    - path: scripts/absa/metrics_from_predictions.py
      hash: md5
      md5: a8e85593c5282a85394a428859a2f507
      size: 7372
    outs:
    - path: reports/absa/phase2_eval_thr90
      hash: md5
      md5: 19d30eb8ab1be7b372dcc74e98378539.dir
      size: 2899394
      nfiles: 12
  absa_eval_thr80:
    cmd: "python scripts/absa/metrics_from_predictions.py --predictions_parquet reports/albert_sample_30pct/eval/predictions.parquet
      --out_dir reports/absa/phase2_eval_thr80 --neutral_threshold 0.80 --save_changed\n"
    deps:
    - path: reports/albert_sample_30pct/eval/predictions.parquet
      hash: md5
      md5: 87938fb8ebe761a3cf982fb371a7cd71
      size: 2781658
    - path: scripts/absa/metrics_from_predictions.py
      hash: md5
      md5: a8e85593c5282a85394a428859a2f507
      size: 7372
    outs:
    - path: reports/absa/phase2_eval_thr80
      hash: md5
      md5: fea170677b3f1c816c30def156893995.dir
      size: 3171819
      nfiles: 13
  absa_eval_thr65:
    cmd: "python scripts/absa/metrics_from_predictions.py --predictions_parquet reports/albert_sample_30pct/eval/predictions.parquet
      --out_dir reports/absa/phase2_eval_thr65 --neutral_threshold 0.65 --save_changed\n"
    deps:
    - path: reports/albert_sample_30pct/eval/predictions.parquet
      hash: md5
      md5: 87938fb8ebe761a3cf982fb371a7cd71
      size: 2781658
    - path: scripts/absa/metrics_from_predictions.py
      hash: md5
      md5: a8e85593c5282a85394a428859a2f507
      size: 7372
    outs:
    - path: reports/absa/phase2_eval_thr65
      hash: md5
      md5: 9da07f23a01aca0d592402e7daab6614.dir
      size: 3021481
      nfiles: 13
  prepare_ABSA_test_full_dataset:
    cmd: "python scripts/training/prepare_test_parquet.py --input data/trusted/reviews_full
      --outdir data/exploitation/modelos_input/ABSA_test_full_dataset --seed 42\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 4485207d96ba5a6d739a8b5570c6df6d.dir
      size: 495378510
      nfiles: 18
    - path: scripts/training/prepare_test_parquet.py
      hash: md5
      md5: 347ee9d1a01887aea96a63ae36cad088
      size: 4478
    outs:
    - path: data/exploitation/modelos_input/ABSA_test_full_dataset
      hash: md5
      md5: 3077d178f8c76c68c7613731377568c2.dir
      size: 495740344
      nfiles: 3
  convert_delta_to_parquet_snapshot:
    cmd: python scripts/infer/convert_delta_to_parquet_snapshot.py --input_path 
      data/trusted/reviews_full --output_path 
      data/trusted/reviews_full_snapshot.parquet
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 4485207d96ba5a6d739a8b5570c6df6d.dir
      size: 495378510
      nfiles: 18
    - path: scripts/infer/convert_delta_to_parquet_snapshot.py
      hash: md5
      md5: 72fcd16d30038f1c1451001882fdb246
      size: 1059
    outs:
    - path: data/trusted/reviews_full_snapshot.parquet
      hash: md5
      md5: 015c03bc808ac43ac453e553c632bec7.dir
      size: 495361508
      nfiles: 20
  infer_sentiment_full_pandas:
    cmd: python scripts/infer/infer_sentiment_full_pandas.py --model_dir 
      models/albert_sample_30pct --input_parquet 
      data/trusted/reviews_full_snapshot.parquet --output_parquet 
      reports/albert_sample_30pct/infer_full_pandas/predictions.parquet 
      --params_file params.yaml
    deps:
    - path: data/trusted/reviews_full_snapshot.parquet
      hash: md5
      md5: 015c03bc808ac43ac453e553c632bec7.dir
      size: 495361508
      nfiles: 20
    - path: models/albert_sample_30pct
      hash: md5
      md5: 923ed8e16d5c6e248094aff1bf38c3cf.dir
      size: 49784962
      nfiles: 8
    - path: params.yaml
      hash: md5
      md5: 8465281c1d6fce48d43dd12b939f12c9
      size: 5766
    - path: scripts/infer/infer_sentiment_full_pandas.py
      hash: md5
      md5: 4d6ce84c3b555a0d7050301b07641dd8
      size: 4054
    params:
      params.yaml:
        infer_sentiment_full_pandas.batch_size: 64
        infer_sentiment_full_pandas.id_col: review_id
        infer_sentiment_full_pandas.max_length: 192
        infer_sentiment_full_pandas.text_col: review_text_clean
    outs:
    - path: reports/albert_sample_30pct/infer_full_pandas/predictions.parquet
      hash: md5
      md5: 16152215958df9193ea75fcc01d43017
      size: 57337966
