schema: '2.0'
stages:
  ingest_kaggle:
    cmd: "python scripts/data_ingestion/descarga_kaggle_reviews.py --out data/landing/sephora/raw\n"
    deps:
    - path: scripts/data_ingestion/descarga_kaggle_reviews.py
      hash: md5
      md5: e27b06cc672ef4f0b2347bf61ccb6322
      size: 762
    outs:
    - path: data/landing/sephora/raw
      hash: md5
      md5: 8b7019941c39ea0d57fae739d69994b5.dir
      size: 528949733
      nfiles: 6
  conversion_a_delta:
    cmd: "python scripts/data_cleaning/conversion_a_delta.py --input data/landing/sephora/raw
      --output data/landing/sephora/delta\n"
    deps:
    - path: data/landing/sephora/raw
      hash: md5
      md5: 8b7019941c39ea0d57fae739d69994b5.dir
      size: 528949733
      nfiles: 6
    - path: scripts/data_cleaning/conversion_a_delta.py
      hash: md5
      md5: f2e92a0eb8508d5d7f9f8543545af804
      size: 1737
    outs:
    - path: data/landing/sephora/delta
      hash: md5
      md5: aa2303e57c792c430938ce716d3da7b0.dir
      size: 230118963
      nfiles: 172
  trusted_clean_driver:
    cmd: python scripts/data_cleaning/trusted_clean_driver.py --input 
      data/landing/sephora/delta --output data/trusted/sephora_clean
    deps:
    - path: data/landing/sephora/delta
      hash: md5
      md5: aa2303e57c792c430938ce716d3da7b0.dir
      size: 230118963
      nfiles: 172
    - path: scripts/data_cleaning/trusted_clean_driver.py
      hash: md5
      md5: 12fb524919587f142c3e2d8a0b638787
      size: 805
    - path: scripts/data_cleaning/trusted_clean_single.py
      hash: md5
      md5: e9f9c94752272c42f4c257b369e68e8b
      size: 4336
    outs:
    - path: data/trusted/sephora_clean
      hash: md5
      md5: 42a297662c563d473751368e7c5c7e73.dir
      size: 500916699
      nfiles: 252
  merge_trusted_reviews:
    cmd: python scripts/data_cleaning/merge_trusted_reviews.py --input-dir 
      data/trusted/sephora_clean --output data/trusted/reviews_full
    deps:
    - path: data/trusted/sephora_clean
      hash: md5
      md5: 42a297662c563d473751368e7c5c7e73.dir
      size: 500916699
      nfiles: 252
    - path: scripts/data_cleaning/merge_trusted_reviews.py
      hash: md5
      md5: 328357b16b26547e2b06709acb583b63
      size: 5557
    outs:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 5269b492d98c898e54fa130f8855e3a8.dir
      size: 495378510
      nfiles: 18
  eda_full:
    cmd: "python scripts/EDA/eda_reviews.py --input data/trusted/reviews_full --outdir
      reports/eda/full --tokenizer albert-base-v2\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 5269b492d98c898e54fa130f8855e3a8.dir
      size: 495378510
      nfiles: 18
    - path: params.yaml
      hash: md5
      md5: 00a546fbc9a54469af43a6b7ddbe0084
      size: 13034
    - path: scripts/EDA/eda_reviews.py
      hash: md5
      md5: 6235ecad747eb664623c25c539bb2a67
      size: 10430
    outs:
    - path: reports/eda/full
      hash: md5
      md5: 468d72acb76f922c40ea44be303550ea.dir
      size: 91181
      nfiles: 10
  sample_reviews:
    cmd: "python scripts/data_cleaning/sample_reviews.py --input data/trusted/reviews_full
      --output data/trusted/reviews_sample_30pct --frac 0.30 --by labels --seed 42\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 08549c8975b204736b6d85c1bb6a55a8.dir
      size: 493840996
      nfiles: 18
    - path: scripts/data_cleaning/sample_reviews.py
      hash: md5
      md5: b53be00c693d1b0eca07a1c53acbfe64
      size: 3658
    outs:
    - path: data/trusted/reviews_sample_30pct
      hash: md5
      md5: 2f4abe9eececec8710ea87937d163ea7.dir
      size: 148792281
      nfiles: 18
  eda_sample:
    cmd: python scripts/EDA/eda_reviews.py --input 
      data/trusted/reviews_sample_30pct --outdir reports/eda/sample_30pct 
      --tokenizer albert-base-v2
    deps:
    - path: data/trusted/reviews_sample_30pct
      hash: md5
      md5: 2f4abe9eececec8710ea87937d163ea7.dir
      size: 148792281
      nfiles: 18
    - path: params.yaml
      hash: md5
      md5: 1cc224cc01c4ed14dd211f948a3e9977
      size: 1052
    - path: scripts/EDA/eda_reviews.py
      hash: md5
      md5: 6235ecad747eb664623c25c539bb2a67
      size: 10430
    outs:
    - path: reports/eda/sample_30pct
      hash: md5
      md5: f00407d91fdf27502b34286c503e82a3.dir
      size: 88768
      nfiles: 10
  eda_compare_full_vs_sample_30pct:
    cmd: python scripts/EDA/eda_compare.py --full reports/eda/full --sample 
      reports/eda/sample_30pct --outdir reports/eda/compare_full_vs_sample_30pct
    deps:
    - path: reports/eda/full
      hash: md5
      md5: 7bf3ddaa898dd7f5fd79c27084c2c550.dir
      size: 91160
      nfiles: 10
    - path: reports/eda/sample_30pct
      hash: md5
      md5: f00407d91fdf27502b34286c503e82a3.dir
      size: 88768
      nfiles: 10
    - path: scripts/EDA/eda_compare.py
      hash: md5
      md5: ccbfd0ac430439ce9b8480693f4f6702
      size: 6597
    outs:
    - path: reports/eda/compare_full_vs_sample_30pct
      hash: md5
      md5: ac22c9f240eab39a98b6d5ffa5db78a9.dir
      size: 6506
      nfiles: 7
  split_train_val_test:
    cmd: "python scripts/training/prepare_test_parquet.py --input  data/trusted/reviews_sample_30pct
      --outdir data/exploitation/modelos_input/sample_tvt --seed 42\n"
    deps:
    - path: data/trusted/reviews_sample_30pct
      hash: md5
      md5: 353a151684796b369a4e95a3ae6d7649.dir
      size: 152013041
      nfiles: 130
    - path: params.yaml
      hash: md5
      md5: 00a546fbc9a54469af43a6b7ddbe0084
      size: 13034
    - path: scripts/training/prepare_test_parquet.py
      hash: md5
      md5: 347ee9d1a01887aea96a63ae36cad088
      size: 4478
    outs:
    - path: data/exploitation/modelos_input/sample_tvt
      hash: md5
      md5: 5c63b7757ecfed942b5e6c7d6b8899c9.dir
      size: 141635093
      nfiles: 3
  train_albert_sample:
    cmd: "MLFLOW_RUN_NAME=albert_sample_30pct python scripts/training/train_albert_from_parquets.py
      --train data/exploitation/modelos_input/sample_tvt/train --val   data/exploitation/modelos_input/sample_tvt/val
      --model-out models/albert_sample_30pct --params params.yaml\n"
    deps:
    - path: data/exploitation/modelos_input/sample_tvt/train
      hash: md5
      md5: 5768c2c6246881fb17ac27c31bfbd99c.dir
      size: 105981778
      nfiles: 1
    - path: data/exploitation/modelos_input/sample_tvt/val
      hash: md5
      md5: ee5149656637558978aca2d916bf7d85.dir
      size: 14258986
      nfiles: 1
    - path: params.yaml
      hash: md5
      md5: 00a546fbc9a54469af43a6b7ddbe0084
      size: 13034
    - path: scripts/training/train_albert_from_parquets.py
      hash: md5
      md5: abf0b5fb9563be466a538cf21764d5ad
      size: 31872
    outs:
    - path: models/albert_sample_30pct
      hash: md5
      md5: f6330090999f97551608fc5ccf171786.dir
      size: 49798958
      nfiles: 8
  evaluate_albert_sample:
    cmd: "PYTHONNOUSERSITE=1 TRANSFORMERS_NO_TF=1 TRANSFORMERS_NO_JAX=1 USE_TF=0 USE_JAX=0
      /home/pedro/MASTER_BIGDATA/venv/bin/python scripts/training/evaluate_albert.py
      --model_dir models/albert_sample_30pct --test_parquet data/exploitation/modelos_input/sample_tvt/test
      --output_dir reports/albert_sample_30pct/eval\n"
    deps:
    - path: data/exploitation/modelos_input/sample_tvt/test
      hash: md5
      md5: 372a143f47e907f1b1fa34b9b3c570c4.dir
      size: 21394329
      nfiles: 1
    - path: models/albert_sample_30pct
      hash: md5
      md5: f6330090999f97551608fc5ccf171786.dir
      size: 49798958
      nfiles: 8
    - path: scripts/training/evaluate_albert.py
      hash: md5
      md5: 65666831a43b30e2c23a14ae56ac6214
      size: 10535
    outs:
    - path: reports/albert_sample_30pct/eval
      hash: md5
      md5: 50a8a590a0fe29927b3cc316cf9eb253.dir
      size: 2838317
      nfiles: 6
  train_albert:
    cmd: "python scripts/training/train_albert_from_parquets.py --train data/trusted/splits/train
      --val   data/trusted/splits/val --model-out models/albert_sample_30pct --params
      params.yaml\n"
    deps:
    - path: data/trusted/splits/train
      hash: md5
      md5: 65af6292cf6401a314390f0de62fc38a.dir
      size: 64893152
      nfiles: 18
    - path: data/trusted/splits/val
      hash: md5
      md5: fc3b1f9f978117ee50cd4c007fb2a2ae.dir
      size: 28380878
      nfiles: 18
    - path: params.yaml
      hash: md5
      md5: 5a9b64da1df3b206ebc3bf5bef6d42f3
      size: 3061
    - path: scripts/training/train_albert_from_parquets.py
      hash: md5
      md5: 26a546ff762a2c400ba78a867913b983
      size: 22305
    outs:
    - path: models/albert_sample_30pct
      hash: md5
      md5: c45f462a87128665e61a6c2fa9967281.dir
      size: 386202977
      nfiles: 35
  infer_albert_all:
    cmd: "python scripts/training/infer_albert_all.py --model_dir models/albert_sample_30pct
      --input_parquet data/trusted/reviews_full --output_parquet reports/albert_sample_30pct/infer/predictions.parquet
      --eval_output_dir reports/albert_sample_30pct/infer_eval_full --text_col review_text_clean
      --id_col review_id --label_col label --max_length 192 --batch_size 256 --labels
      negative neutral positive\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 660f5d166d2f7ad288ca7729c8deb3e9.dir
      size: 495606028
      nfiles: 24
    - path: models/albert_sample_30pct
      hash: md5
      md5: d71a6277af2ec5b4120fa66aea0113cf.dir
      size: 49784806
      nfiles: 8
    - path: scripts/training/infer_albert_all.py
      hash: md5
      md5: 0664a8fb2bf0e4cc6dccb16a5c9ba619
      size: 10348
    params:
      params.yaml:
        infer:
          model_dir: models/albert_sample_30pct
          input_parquet: data/trusted/reviews_full
          output_parquet: reports/albert_sample_30pct/infer/predictions.parquet
          eval_output_dir: reports/albert_sample_30pct/infer_eval_full
          text_col: review_text_clean
          id_col: review_id
          label_col: label
          batch_size: 1280
          max_length: 192
    outs:
    - path: reports/albert_sample_30pct/infer/predictions.parquet
      hash: md5
      md5: 17bea98847c6a5beeef26f487a17fa5e
      size: 42520506
  trusted_sample_30:
    cmd: "python scripts/data_cleaning/sample_reviews.py --input  data/trusted/reviews_full
      --output data/trusted/reviews_sample_30pct --frac 0.3 --by sentiment_category
      --format delta --seed 42 --coalesce 64 --balance true\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 5269b492d98c898e54fa130f8855e3a8.dir
      size: 495378510
      nfiles: 18
    - path: scripts/data_cleaning/sample_reviews.py
      hash: md5
      md5: 6a90647eaec79be144757ee09a407440
      size: 10610
    params:
      params.yaml:
        sampling:
          frac: 0.3
          by: sentiment_category
          seed: 42
          format: delta
          coalesce: 64
          balance: true
    outs:
    - path: data/trusted/reviews_sample_30pct
      hash: md5
      md5: 353a151684796b369a4e95a3ae6d7649.dir
      size: 152013041
      nfiles: 130
  eda_sample_30:
    cmd: "python scripts/EDA/eda_reviews.py --input data/trusted/reviews_sample_30pct
      --outdir reports/eda/sample_30 --tokenizer albert-base-v2\n"
    deps:
    - path: data/trusted/reviews_sample_30pct
      hash: md5
      md5: 353a151684796b369a4e95a3ae6d7649.dir
      size: 152013041
      nfiles: 130
    - path: params.yaml
      hash: md5
      md5: 00a546fbc9a54469af43a6b7ddbe0084
      size: 13034
    - path: scripts/EDA/eda_reviews.py
      hash: md5
      md5: 6235ecad747eb664623c25c539bb2a67
      size: 10430
    outs:
    - path: reports/eda/sample_30
      hash: md5
      md5: 74b0ef1e860fc70e6d6c79b2b3327a7f.dir
      size: 86531
      nfiles: 10
  eda_compare_full_vs_30:
    cmd: "python scripts/EDA/eda_compare.py --a data/trusted/reviews_full --b data/trusted/reviews_sample_30pct
      --outdir reports/eda/compare_full_vs_30 --by sentiment_category --input-format
      auto --tokenizer albert-base-v2 --sample-rows 120000 --max-len 128 --clip-tokens
      true --silence-tokenizer-warnings true\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 5269b492d98c898e54fa130f8855e3a8.dir
      size: 495378510
      nfiles: 18
    - path: data/trusted/reviews_sample_30pct
      hash: md5
      md5: 353a151684796b369a4e95a3ae6d7649.dir
      size: 152013041
      nfiles: 130
    - path: scripts/EDA/eda_compare.py
      hash: md5
      md5: 47f357297a778055cea6698a7b44810b
      size: 11381
    params:
      params.yaml:
        eda_compare_full_vs_30:
          a: data/trusted/reviews_full
          b: data/trusted/reviews_sample_30pct
          outdir: reports/eda/compare_full_vs_30
          by: sentiment_category
          input_format: auto
          tokenizer: albert-base-v2
          sample_rows: 120000
          max_len: 128
          clip_tokens: true
          silence_tokenizer_warnings: true
    outs:
    - path: reports/eda/compare_full_vs_30
      hash: md5
      md5: 8dd5c6c2882c167ff51d730c332a9c84.dir
      size: 57415
      nfiles: 24
  infer_albert_forward:
    cmd: "PYTHONNOUSERSITE=1 TRANSFORMERS_NO_TF=1 TRANSFORMERS_NO_JAX=1 USE_TF=0 USE_JAX=0
      /home/pedro/MASTER_BIGDATA/venv/bin/python scripts/training/infer_albert_all.py
      --model_dir models/albert_sample_30pct --input_parquet data/trusted/reviews_full
      --output_parquet reports/albert_sample_30pct/infer/predictions.parquet --eval_output_dir
      reports/albert_sample_30pct/infer_eval_full --text_col review_text_clean --id_col
      review_id --batch_size 128\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: aeee9d89c9d221c5a91da28ee292a39b.dir
      size: 494842050
      nfiles: 82
    - path: models/albert_sample_30pct
      hash: md5
      md5: d71a6277af2ec5b4120fa66aea0113cf.dir
      size: 49784806
      nfiles: 8
    - path: scripts/training/infer_albert_all.py
      hash: md5
      md5: 24f7a940fafa350c7ee192dba1f2969b
      size: 4038
    outs:
    - path: reports/albert_sample_30pct/infer/predictions.parquet
      hash: md5
      md5: a5fedaafa341c219fec1b6bb8c03bb76
      size: 43106181
  make_rest_from_full:
    cmd: "python scripts/data_cleaning/make_rest_from_full.py --full data/trusted/reviews_full
      --sample-root data/exploitation/modelos_input/sample_tvt --sample-delta data/trusted/reviews_sample_30pct
      --out data/exploitation/modelos_input/rest_from_full --format parquet --coalesce
      64\n"
    deps:
    - path: data/exploitation/modelos_input/sample_tvt/test
      hash: md5
      md5: bfa024e0523b5306f46976ba7d064f60.dir
      size: 21251257
      nfiles: 1
    - path: data/exploitation/modelos_input/sample_tvt/train
      hash: md5
      md5: 9209563c84f500f95462c3c20a78aaf0.dir
      size: 106044050
      nfiles: 1
    - path: data/exploitation/modelos_input/sample_tvt/val
      hash: md5
      md5: 3897382c33dacb582249c542f7c79759.dir
      size: 14238818
      nfiles: 1
    - path: data/trusted/reviews_full
      hash: md5
      md5: 4485207d96ba5a6d739a8b5570c6df6d.dir
      size: 495378510
      nfiles: 18
    - path: data/trusted/reviews_sample_30pct
      hash: md5
      md5: 3c913bd98909183982d0cc53110a1da0.dir
      size: 143121002
      nfiles: 50
    - path: scripts/data_cleaning/make_rest_from_full.py
      hash: md5
      md5: 3bb53988de3fbe6a76eed0afa4b6aede
      size: 5388
    outs:
    - path: data/exploitation/modelos_input/rest_from_full
      hash: md5
      md5: 05e873d95fec452607af14e895877784.dir
      size: 353112531
      nfiles: 20
  evaluate_albert_rest:
    cmd: "python scripts/training/evaluate_albert.py --model_dir models/albert_sample_30pct
      --test_parquet data/exploitation/modelos_input/rest_from_full --output_dir reports/albert_sample_30pct/eval_rest
      --max_len 192\n"
    deps:
    - path: data/exploitation/modelos_input/rest_from_full
      hash: md5
      md5: 3d191c7bbccd2f2fbb5de1335383c429.dir
      size: 352996248
      nfiles: 20
    - path: models/albert_sample_30pct
      hash: md5
      md5: e45ca43f22c5129254eef74a3224e7e9.dir
      size: 49784962
      nfiles: 8
    - path: scripts/training/evaluate_albert.py
      hash: md5
      md5: 65666831a43b30e2c23a14ae56ac6214
      size: 10535
    outs:
    - path: reports/albert_sample_30pct/eval_rest
      hash: md5
      md5: 6ddfbe74ecac33d052ba902bd25f3846.dir
      size: 41250955
      nfiles: 6
  infer_top50_upvoted_ulta:
    cmd: "python scripts/infer/infer_top_upvoted_ulta.py --input_delta \"data/trusted/ulta_clean/Ulta
      Skincare Reviews\" --model_dir models/albert_sample_30pct --top_n 50 --output_parquet
      reports/albert_sample_30pct/infer_top50_upvoted_ulta/predictions.parquet\n"
    deps:
    - path: data/trusted/ulta_clean/Ulta Skincare Reviews
      hash: md5
      md5: beebb92e4be0fdb3bc2b5731308aa47c.dir
      size: 3627645
      nfiles: 24
    - path: models/albert_sample_30pct
      hash: md5
      md5: 923ed8e16d5c6e248094aff1bf38c3cf.dir
      size: 49784962
      nfiles: 8
    - path: scripts/infer/infer_top_upvoted_ulta.py
      hash: md5
      md5: 5c9dc38cb146fbe6d20410672e70c6e3
      size: 10397
    outs:
    - path: reports/albert_sample_30pct/infer_top50_upvoted_ulta
      hash: md5
      md5: d75802f5892bc2910d1f23ecaa5ca57b.dir
      size: 53824
      nfiles: 12
  merge_reviews_product_info:
    cmd: "python scripts/data_cleaning/merge_reviews_product_info.py --reviews_path
      data/trusted/reviews_full --product_info_path data/trusted/sephora_clean/product_info
      --output_path data/trusted/reviews_product_info_clean_full --input_format auto
      --output_format delta --repartition 0 --coalesce 64 --product_prefix pinfo_
      --broadcast_product_info true\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 5269b492d98c898e54fa130f8855e3a8.dir
      size: 495378510
      nfiles: 18
    - path: data/trusted/sephora_clean/product_info
      hash: md5
      md5: fc0e5fdb5651b1d1fb0ed3a780f12c2f.dir
      size: 2869951
      nfiles: 12
    - path: scripts/data_cleaning/merge_reviews_product_info.py
      hash: md5
      md5: 8146cb418204fc6ac7c89d9e5ef61ca9
      size: 7736
    params:
      params.yaml:
        merge_reviews_product_info.broadcast_product_info: 'true'
        merge_reviews_product_info.coalesce: 64
        merge_reviews_product_info.input_format: auto
        merge_reviews_product_info.output_format: delta
        merge_reviews_product_info.product_prefix: pinfo_
        merge_reviews_product_info.repartition: 0
        paths:
          reviews_full: data/trusted/reviews_full
          product_info: data/trusted/sephora_clean/product_info
          merged_out: data/trusted/reviews_product_info_clean_full
    outs:
    - path: data/trusted/reviews_product_info_clean_full
      hash: md5
      md5: c6ac4ed4b43b109b205b6a4909967bb2.dir
      size: 796564328
      nfiles: 20
  gen_aspects_json:
    cmd: "python -c \"import os, json, yaml; d=yaml.safe_load(open('params.yaml'));
      os.makedirs('configs', exist_ok=True); json.dump(d['aspects_ontology_en'], open('configs/aspects_en.json','w'),
      ensure_ascii=False, indent=2)\"\n"
    deps:
    - path: params.yaml
      hash: md5
      md5: 00a546fbc9a54469af43a6b7ddbe0084
      size: 13034
    params:
      params.yaml:
        aspects_ontology_en:
          fragrance:
          - fragrance
          - scent
          - smell
          - aroma
          - perfume
          - notes
          - odor
          - fragrant
          longevity:
          - longevity
          - long-lasting
          - lasting
          - wear time
          - duration
          - staying power
          sillage:
          - sillage
          - projection
          - trail
          - leaves a trail
          price:
          - price
          - price point
          - cost
          - value
          - worth
          - expensive
          - cheap
          - overpriced
          packaging:
          - packaging
          - bottle
          - cap
          - pump
          - box
          - container
          - design
          texture:
          - texture
          - consistency
          - feel
          - thick
          - thin
          - creamy
          - watery
          - sticky
          - greasy
          - lightweight
          - silky
          hydration:
          - hydration
          - moisturizing
          - hydrating
          - moisture
          - drying
          - dehydrating
          application:
          - application
          - apply
          - applies
          - spreads
          - absorbs
          - glides
          - blendability
          - easy to use
          finish:
          - finish
          - matte
          - dewy
          - glowy
          - glossy
          - sheen
          - shine
          irritation:
          - irritation
          - irritates
          - sting
          - burning
          - redness
          - itch
          - breakout
          - allergic
          - sensitivity
          ingredients:
          - ingredients
          - alcohol
          - parabens
          - sulfates
          - silicones
          - fragrance-free
          - clean
          - formula
          effectiveness:
          - effectiveness
          - works
          - results
          - performance
          - improvement
          - does nothing
    outs:
    - path: configs/aspects_en.json
      hash: md5
      md5: 1f1cbebab683cf097855ecfa9cfdecd8
      size: 1617
  build_ate_trusted:
    cmd: "python scripts/absa/build_ate_trusted_from_ontology.py --input_path data/trusted/reviews_product_info_clean_full
      --input_format delta --text_col review_text_clean --id_col review_id --ontology_json
      configs/aspects_en.json --output_dir data/trusted/ate --train_filename train.jsonl
      --valid_filename valid.jsonl --sample_fraction 0.2 --max_reviews 300000 --train_valid_split
      0.9 --keep_neg_ratio 0.2 --seed 13\n"
    deps:
    - path: configs/aspects_en.json
      hash: md5
      md5: 1f1cbebab683cf097855ecfa9cfdecd8
      size: 1617
    - path: data/trusted/reviews_product_info_clean_full
      hash: md5
      md5: c6ac4ed4b43b109b205b6a4909967bb2.dir
      size: 796564328
      nfiles: 20
    - path: scripts/absa/build_ate_trusted_from_ontology.py
      hash: md5
      md5: 0f4076985d3d58641f55425086c1cbfd
      size: 7793
    params:
      params.yaml:
        ate_train.train_path: data/trusted/ate/train.jsonl
        ate_train.valid_path: data/trusted/ate/valid.jsonl
        ate_trusted:
          input_path: data/trusted/reviews_product_info_clean_full
          input_format: delta
          text_col: review_text_clean
          id_col: review_id
          ontology_json: configs/aspects_en.json
          output_dir: data/trusted/ate
          train_filename: train.jsonl
          valid_filename: valid.jsonl
          sample_fraction: 0.2
          max_reviews: 300000
          train_valid_split: 0.9
          keep_neg_ratio: 0.2
          seed: 13
    outs:
    - path: data/trusted/ate/train.jsonl
      hash: md5
      md5: 568ed245ad24e00d4717863da31a0d72
      size: 132639876
    - path: data/trusted/ate/valid.jsonl
      hash: md5
      md5: dcd35788c2d3eb3e034e1c7fe278d281
      size: 14610067
  train_ate_bio:
    cmd: "python scripts/absa/train_ate_bio.py --train_path data/trusted/ate/train.jsonl
      --valid_path data/trusted/ate/valid.jsonl --model_name roberta-base --output_dir
      models/ate_roberta_base --epochs 4 --lr 2e-05 --batch_size 32 --grad_accum 2
      --max_length 192 --fp16 false --bf16 true --grad_checkpoint false --dataloader_workers
      8\n"
    deps:
    - path: data/trusted/ate/train.jsonl
      hash: md5
      md5: 568ed245ad24e00d4717863da31a0d72
      size: 132639876
    - path: data/trusted/ate/valid.jsonl
      hash: md5
      md5: dcd35788c2d3eb3e034e1c7fe278d281
      size: 14610067
    - path: scripts/absa/train_ate_bio.py
      hash: md5
      md5: 2d388cccc6f6208197038b4dec501bbb
      size: 9197
    params:
      params.yaml:
        ate_train:
          model_name: roberta-base
          output_dir: models/ate_roberta_base
          epochs: 4
          lr: 2e-05
          batch_size: 32
          grad_accum: 2
          max_length: 192
          fp16: false
          bf16: true
          grad_checkpoint: false
          dataloader_workers: 8
          train_path: data/trusted/ate/train.jsonl
          valid_path: data/trusted/ate/valid.jsonl
    outs:
    - path: models/ate_roberta_base
      hash: md5
      md5: 5368f00b021de10f3462450a264880d2.dir
      size: 1994821285
      nfiles: 20
  infer_ate_spans:
    cmd: "python scripts/absa/infer_ate_spans.py --model_dir models/ate_roberta_base
      --input_path data/trusted/reviews_product_info_clean_full --input_format delta
      --text_col review_text_clean --id_col review_id --output_parquet reports/absa/ate_spans.parquet
      --max_length 192 --batch_size 128 --flush_rows 25000\n"
    deps:
    - path: data/trusted/reviews_product_info_clean_full
      hash: md5
      md5: c6ac4ed4b43b109b205b6a4909967bb2.dir
      size: 796564328
      nfiles: 20
    - path: models/ate_roberta_base
      hash: md5
      md5: 5368f00b021de10f3462450a264880d2.dir
      size: 1994821285
      nfiles: 20
    - path: scripts/absa/infer_ate_spans.py
      hash: md5
      md5: b57c3d9890578e13d1eac09d51759be9
      size: 12960
    params:
      params.yaml:
        ate_infer:
          model_dir: models/ate_roberta_base
          input_path: data/trusted/reviews_product_info_clean_full
          input_format: delta
          text_col: review_text_clean
          id_col: review_id
          output_parquet: reports/absa/ate_spans.parquet
          max_length: 192
          batch_size: 128
          flush_rows: 25000
    outs:
    - path: reports/absa/ate_spans.parquet
      hash: md5
      md5: 4102d4e746233cfa29e51819893a20ce
      size: 40073891
  map_ate_spans:
    cmd: "python scripts/absa/map_spans_to_ontology.py --spans_parquet reports/absa/ate_spans.parquet
      --ontology_json configs/aspects_en.json --output_parquet reports/absa/ate_spans_mapped.parquet
      --threshold 0.45\n"
    deps:
    - path: configs/aspects_en.json
      hash: md5
      md5: 1f1cbebab683cf097855ecfa9cfdecd8
      size: 1617
    - path: reports/absa/ate_spans.parquet
      hash: md5
      md5: 4102d4e746233cfa29e51819893a20ce
      size: 40073891
    - path: scripts/absa/map_spans_to_ontology.py
      hash: md5
      md5: 2a66e66e776129c17888700ec3fec240
      size: 3146
    params:
      params.yaml:
        ate_map:
          spans_parquet: reports/absa/ate_spans.parquet
          ontology_json: configs/aspects_en.json
          output_parquet: reports/absa/ate_spans_mapped.parquet
          threshold: 0.45
    outs:
    - path: reports/absa/ate_spans_mapped.parquet
      hash: md5
      md5: 53b4c7b4d15c1d370e2d71b565d1fdb6
      size: 35708424
  absa_build_all:
    cmd: "python scripts/absa/build_absa_dataset.py --spans_parquet reports/absa/ate_spans.parquet
      --map_parquet   reports/absa/ate_spans_mapped.parquet --sentiment_parquet reports/albert_sample_30pct/infer_full_pandas/predictions.parquet
      --id_col review_id --span_text_col aspect_span --category_col aspect_norm --sentiment_col
      pred_3 --output_dir reports/absa/final_all\n"
    deps:
    - path: params.yaml
      hash: md5
      md5: 00a546fbc9a54469af43a6b7ddbe0084
      size: 13034
    - path: reports/absa/ate_spans.parquet
      hash: md5
      md5: 4102d4e746233cfa29e51819893a20ce
      size: 40073891
    - path: reports/absa/ate_spans_mapped.parquet
      hash: md5
      md5: 53b4c7b4d15c1d370e2d71b565d1fdb6
      size: 35708424
    - path: reports/albert_sample_30pct/infer_full_pandas/predictions.parquet
      hash: md5
      md5: 76cac934368a101c694d099517b5c1fd
      size: 57378857
    - path: scripts/absa/build_absa_dataset.py
      hash: md5
      md5: 37777cd65e975fafb0adb50ead1c0e9e
      size: 17156
    outs:
    - path: reports/absa/final_all
      hash: md5
      md5: be8f0f6bdf23b2ca086132fb8ee8272e.dir
      size: 33235395
      nfiles: 76
  absa_eval_thr90:
    cmd: "python scripts/absa/metrics_from_predictions.py --predictions_parquet reports/albert_sample_30pct/eval/predictions.parquet
      --out_dir reports/absa/phase2_eval_thr90 --neutral_threshold 0.90\n"
    deps:
    - path: reports/albert_sample_30pct/eval/predictions.parquet
      hash: md5
      md5: 87938fb8ebe761a3cf982fb371a7cd71
      size: 2781658
    - path: scripts/absa/metrics_from_predictions.py
      hash: md5
      md5: a8e85593c5282a85394a428859a2f507
      size: 7372
    outs:
    - path: reports/absa/phase2_eval_thr90
      hash: md5
      md5: 19d30eb8ab1be7b372dcc74e98378539.dir
      size: 2899394
      nfiles: 12
  absa_eval_thr80:
    cmd: "python scripts/absa/metrics_from_predictions.py --predictions_parquet reports/albert_sample_30pct/eval/predictions.parquet
      --out_dir reports/absa/phase2_eval_thr80 --neutral_threshold 0.80 --save_changed\n"
    deps:
    - path: reports/albert_sample_30pct/eval/predictions.parquet
      hash: md5
      md5: 87938fb8ebe761a3cf982fb371a7cd71
      size: 2781658
    - path: scripts/absa/metrics_from_predictions.py
      hash: md5
      md5: a8e85593c5282a85394a428859a2f507
      size: 7372
    outs:
    - path: reports/absa/phase2_eval_thr80
      hash: md5
      md5: fea170677b3f1c816c30def156893995.dir
      size: 3171819
      nfiles: 13
  absa_eval_thr65:
    cmd: "python scripts/absa/metrics_from_predictions.py --predictions_parquet reports/albert_sample_30pct/eval/predictions.parquet
      --out_dir reports/absa/phase2_eval_thr65 --neutral_threshold 0.65 --save_changed\n"
    deps:
    - path: reports/albert_sample_30pct/eval/predictions.parquet
      hash: md5
      md5: 87938fb8ebe761a3cf982fb371a7cd71
      size: 2781658
    - path: scripts/absa/metrics_from_predictions.py
      hash: md5
      md5: a8e85593c5282a85394a428859a2f507
      size: 7372
    outs:
    - path: reports/absa/phase2_eval_thr65
      hash: md5
      md5: 9da07f23a01aca0d592402e7daab6614.dir
      size: 3021481
      nfiles: 13
  prepare_ABSA_test_full_dataset:
    cmd: "python scripts/training/prepare_test_parquet.py --input data/trusted/reviews_full
      --outdir data/exploitation/modelos_input/ABSA_test_full_dataset --seed 42\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 4485207d96ba5a6d739a8b5570c6df6d.dir
      size: 495378510
      nfiles: 18
    - path: scripts/training/prepare_test_parquet.py
      hash: md5
      md5: 347ee9d1a01887aea96a63ae36cad088
      size: 4478
    outs:
    - path: data/exploitation/modelos_input/ABSA_test_full_dataset
      hash: md5
      md5: 3077d178f8c76c68c7613731377568c2.dir
      size: 495740344
      nfiles: 3
  convert_delta_to_parquet_snapshot:
    cmd: python scripts/infer/convert_delta_to_parquet_snapshot.py --input_path 
      data/trusted/reviews_full --output_path 
      data/trusted/reviews_full_snapshot.parquet
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 5269b492d98c898e54fa130f8855e3a8.dir
      size: 495378510
      nfiles: 18
    - path: scripts/infer/convert_delta_to_parquet_snapshot.py
      hash: md5
      md5: 72fcd16d30038f1c1451001882fdb246
      size: 1059
    outs:
    - path: data/trusted/reviews_full_snapshot.parquet
      hash: md5
      md5: 8d5d3b641de26c8ff30ed294efd89cc3.dir
      size: 495361508
      nfiles: 20
  infer_sentiment_full_pandas:
    cmd: python scripts/infer/infer_sentiment_full_pandas.py --model_dir 
      models/albert_sample_30pct --input_parquet 
      data/trusted/reviews_full_snapshot.parquet --output_parquet 
      reports/albert_sample_30pct/infer_full_pandas/predictions.parquet 
      --params_file params.yaml
    deps:
    - path: data/trusted/reviews_full_snapshot.parquet
      hash: md5
      md5: 8d5d3b641de26c8ff30ed294efd89cc3.dir
      size: 495361508
      nfiles: 20
    - path: models/albert_sample_30pct
      hash: md5
      md5: f6330090999f97551608fc5ccf171786.dir
      size: 49798958
      nfiles: 8
    - path: params.yaml
      hash: md5
      md5: 00a546fbc9a54469af43a6b7ddbe0084
      size: 13034
    - path: scripts/infer/infer_sentiment_full_pandas.py
      hash: md5
      md5: 4d6ce84c3b555a0d7050301b07641dd8
      size: 4054
    params:
      params.yaml:
        infer_sentiment_full_pandas.batch_size: 64
        infer_sentiment_full_pandas.id_col: review_id
        infer_sentiment_full_pandas.max_length: 192
        infer_sentiment_full_pandas.text_col: review_text_clean
    outs:
    - path: reports/albert_sample_30pct/infer_full_pandas/predictions.parquet
      hash: md5
      md5: 76cac934368a101c694d099517b5c1fd
      size: 57378857
  train_rf_sample:
    cmd: "MLFLOW_RUN_NAME=rf_sample_30pct python scripts/training/train_random_forest.py
      --train data/exploitation/modelos_input/sample_tvt/train --val   data/exploitation/modelos_input/sample_tvt/val
      --model-out models/sentiment_rf_sample --params params.yaml\n"
    deps:
    - path: data/exploitation/modelos_input/sample_tvt/train
      hash: md5
      md5: 5768c2c6246881fb17ac27c31bfbd99c.dir
      size: 105981778
      nfiles: 1
    - path: data/exploitation/modelos_input/sample_tvt/val
      hash: md5
      md5: ee5149656637558978aca2d916bf7d85.dir
      size: 14258986
      nfiles: 1
    - path: params.yaml
      hash: md5
      md5: 00a546fbc9a54469af43a6b7ddbe0084
      size: 13034
    - path: scripts/training/train_random_forest.py
      hash: md5
      md5: 514f31ec650499ee2998b0ec845527df
      size: 9625
    outs:
    - path: models/sentiment_rf_sample
      hash: md5
      md5: 50e1ae45067e4a5c2fcfa2c260e5810e.dir
      size: 1481698155
      nfiles: 3
    - path: reports/sentiment_rf
      hash: md5
      md5: 1326822a261df04024eb1286e5f58c84.dir
      size: 17376
      nfiles: 1
  evaluate_rf_sample:
    cmd: "python scripts/training/infer_random_forest.py --model-dir models/sentiment_rf_sample
      --input data/exploitation/modelos_input/sample_tvt/test --output-dir reports/sentiment_rf_sample/eval
      --text-col review_text --id-col review_id --use-extra 1 && python scripts/evaluation/metrics_overall.py
      --preds reports/sentiment_rf_sample/eval/test_predictions.parquet --out_dir
      reports/sentiment_rf_sample/eval\n"
    deps:
    - path: data/exploitation/modelos_input/sample_tvt/test
      hash: md5
      md5: 372a143f47e907f1b1fa34b9b3c570c4.dir
      size: 21394329
      nfiles: 1
    - path: models/sentiment_rf_sample
      hash: md5
      md5: 50e1ae45067e4a5c2fcfa2c260e5810e.dir
      size: 1481698155
      nfiles: 3
    - path: scripts/evaluation/metrics_overall.py
      hash: md5
      md5: 5f870271995dc8e4e110e56c3fe57a02
      size: 2244
      isexec: true
    - path: scripts/training/infer_random_forest.py
      hash: md5
      md5: aaf54ed2f382cf9247b1742ebb4c4ad1
      size: 8716
    outs:
    - path: reports/sentiment_rf_sample/eval
      hash: md5
      md5: b22e9d1d1207b61d6d2585241261bc8b.dir
      size: 2023089
      nfiles: 4
  infer_rf_all:
    cmd: "python scripts/training/infer_random_forest.py --model-dir models/sentiment_rf_sample
      --input data/trusted/reviews_full --output-dir reports/sentiment_rf_sample/infer
      --text-col review_text --id-col review_id --use-extra 1 && python scripts/evaluation/metrics_overall.py
      --preds reports/sentiment_rf_sample/infer/test_predictions.parquet --out_dir
      reports/sentiment_rf_sample/infer_eval_full\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 14aa2cd5dcb06e55d1caedefa145be1e.dir
      size: 495378510
      nfiles: 18
    - path: models/sentiment_rf_sample
      hash: md5
      md5: 3a203eb3349d6e8ffed950f232b2d7a2.dir
      size: 1482049207
      nfiles: 3
    - path: scripts/evaluation/metrics_overall.py
      hash: md5
      md5: 5f870271995dc8e4e110e56c3fe57a02
      size: 2244
      isexec: true
    - path: scripts/training/infer_random_forest.py
      hash: md5
      md5: aaf54ed2f382cf9247b1742ebb4c4ad1
      size: 8716
    outs:
    - path: reports/sentiment_rf_sample/infer
      hash: md5
      md5: fa38debcbf0f4d8fa5bb42d9ddd69f55.dir
      size: 42770315
      nfiles: 1
    - path: reports/sentiment_rf_sample/infer_eval_full
      hash: md5
      md5: 559085834cd433896cc671f4d2e970c1.dir
      size: 58966
      nfiles: 3
  infer_ulta_top50_albert:
    cmd: "python scripts/infer/infer_top_upvoted_ulta.py --backend albert --input_delta
      'data/trusted/ulta_clean/Ulta Skincare Reviews' --model_dir models/albert_sample_30pct
      --top_n 50 --max_len 192 --batch_size 64 --output_parquet reports/albert_sample_30pct/ulta_top50/predictions.parquet
      --coalesce 1 --demote_neutral 1 --min_neutral_prob 0.90\n"
    deps:
    - path: data/trusted/ulta_clean/Ulta Skincare Reviews
      hash: md5
      md5: beebb92e4be0fdb3bc2b5731308aa47c.dir
      size: 3627645
      nfiles: 24
    - path: models/albert_sample_30pct
      hash: md5
      md5: f6330090999f97551608fc5ccf171786.dir
      size: 49798958
      nfiles: 8
    - path: scripts/infer/infer_top_upvoted_ulta.py
      hash: md5
      md5: 38047141fadb6c2443cf255888a88e75
      size: 13255
    outs:
    - path: reports/albert_sample_30pct/ulta_top50
      hash: md5
      md5: 4c1844aada0f1304a34aa65b93046bb2.dir
      size: 51985
      nfiles: 12
  infer_ulta_top50_rf:
    cmd: "python scripts/infer/infer_top_upvoted_ulta.py --backend rf --input_delta
      'data/trusted/ulta_clean/Ulta Skincare Reviews' --model_dir models/sentiment_rf_sample
      --top_n 50 --output_parquet reports/sentiment_rf_sample/ulta_top50/predictions.parquet
      --coalesce 1 --demote_neutral 1 --min_neutral_prob 0.90 --use_title 1 --use_extra
      1\n"
    deps:
    - path: data/trusted/ulta_clean/Ulta Skincare Reviews
      hash: md5
      md5: beebb92e4be0fdb3bc2b5731308aa47c.dir
      size: 3627645
      nfiles: 24
    - path: models/sentiment_rf_sample
      hash: md5
      md5: 50e1ae45067e4a5c2fcfa2c260e5810e.dir
      size: 1481698155
      nfiles: 3
    - path: scripts/infer/infer_top_upvoted_ulta.py
      hash: md5
      md5: 38047141fadb6c2443cf255888a88e75
      size: 13255
    outs:
    - path: reports/sentiment_rf_sample/ulta_top50
      hash: md5
      md5: a153497ef36959a17aff3564b076fb24.dir
      size: 49556
      nfiles: 12
  export_snapshot:
    cmd: "python scripts/absa/export_product_info_snapshot.py --params params.yaml\n"
    deps:
    - path: data/trusted/reviews_product_info_clean_full
      hash: md5
      md5: c6ac4ed4b43b109b205b6a4909967bb2.dir
      size: 796564328
      nfiles: 20
    - path: params.yaml
      hash: md5
      md5: 00a546fbc9a54469af43a6b7ddbe0084
      size: 13034
    - path: scripts/absa/export_product_info_snapshot.py
      hash: md5
      md5: 8339b8b7d53bfcd782f940d3016a8268
      size: 2453
    outs:
    - path: data/exploitation/product_info_snapshot.parquet
      hash: md5
      md5: 9dd1c76c0e480985bea1646c3a5f535e.dir
      size: 53499938
      nfiles: 48
  build_product_cards:
    cmd: "python scripts/absa/build_product_cards.py --params params.yaml\n"
    deps:
    - path: data/exploitation/product_info_snapshot.parquet
      hash: md5
      md5: 9dd1c76c0e480985bea1646c3a5f535e.dir
      size: 53499938
      nfiles: 48
    - path: params.yaml
      hash: md5
      md5: 00a546fbc9a54469af43a6b7ddbe0084
      size: 13034
    - path: reports/absa/ate_spans.parquet
      hash: md5
      md5: 4102d4e746233cfa29e51819893a20ce
      size: 40073891
    - path: reports/absa/ate_spans_mapped.parquet
      hash: md5
      md5: 53b4c7b4d15c1d370e2d71b565d1fdb6
      size: 35708424
    - path: reports/albert_sample_30pct/infer_full_pandas/predictions.parquet
      hash: md5
      md5: 76cac934368a101c694d099517b5c1fd
      size: 57378857
    - path: scripts/absa/build_product_cards.py
      hash: md5
      md5: 0e4ca915fdaabb4f07ce3961f4b567c6
      size: 12898
    outs:
    - path: reports/absa/cards/product_cards.jsonl
      hash: md5
      md5: cd3a89c5824c8916e2da266f4a83a968
      size: 1196215
  absa_insights_altair:
    cmd: "python scripts/absa/absa_insights_altair.py --params params.yaml --spans
      reports/absa/ate_spans.parquet --mapped reports/absa/ate_spans_mapped.parquet
      --sentiment reports/albert_sample_30pct/infer_full_pandas/predictions.parquet
      --product_snapshot data/exploitation/product_info_snapshot.parquet --outdir
      reports/absa/insights --save_csv\n"
    deps:
    - path: data/exploitation/product_info_snapshot.parquet
      hash: md5
      md5: 9dd1c76c0e480985bea1646c3a5f535e.dir
      size: 53499938
      nfiles: 48
    - path: params.yaml
      hash: md5
      md5: 00a546fbc9a54469af43a6b7ddbe0084
      size: 13034
    - path: reports/absa/ate_spans.parquet
      hash: md5
      md5: 4102d4e746233cfa29e51819893a20ce
      size: 40073891
    - path: reports/absa/ate_spans_mapped.parquet
      hash: md5
      md5: 53b4c7b4d15c1d370e2d71b565d1fdb6
      size: 35708424
    - path: reports/albert_sample_30pct/infer_full_pandas/predictions.parquet
      hash: md5
      md5: 76cac934368a101c694d099517b5c1fd
      size: 57378857
    - path: scripts/absa/absa_insights_altair.py
      hash: md5
      md5: 617e1160047c7ab9ad086ec014e10ab3
      size: 13797
    outs:
    - path: reports/absa/insights/charts
      hash: md5
      md5: 49facf50f205f5fa4837b65b88f606e3.dir
      size: 273002
      nfiles: 8
  loves_top10_duckdb:
    cmd: "python scripts/absa/top10_loves_duckdb.py --params params.yaml --src data/trusted/reviews_product_info_clean_full
      --outdir reports/absa/loves_top10\n"
    deps:
    - path: data/trusted/reviews_product_info_clean_full
      hash: md5
      md5: c6ac4ed4b43b109b205b6a4909967bb2.dir
      size: 796564328
      nfiles: 20
    - path: params.yaml
      hash: md5
      md5: 00a546fbc9a54469af43a6b7ddbe0084
      size: 13034
    - path: scripts/absa/top10_loves_duckdb.py
      hash: md5
      md5: 4ce0f34c2b030976a1b30091d6f847ee
      size: 2696
    outs:
    - path: reports/absa/loves_top10/global_top10.csv
      hash: md5
      md5: 5d6f2dbede5246685d6291e47c698e6f
      size: 622
    - path: reports/absa/loves_top10/per_category_top10.csv
      hash: md5
      md5: 07d5d45574b3d076d61fa6c6f3eb0ec7
      size: 9298
  absa_report:
    cmd: python scripts/absa/make_absa_report.py --params params.yaml
    deps:
    - path: params.yaml
      hash: md5
      md5: 00a546fbc9a54469af43a6b7ddbe0084
      size: 13034
    - path: scripts/absa/make_absa_report.py
      hash: md5
      md5: 233c1fbd7e268cad5ed9429b1b7340ad
      size: 1100
    outs:
    - path: reports/absa/final_report/
      hash: md5
      md5: 4ad5d45c587b74fbf560cfe5cde2a846.dir
      size: 1479137
      nfiles: 11
  make_product_cards_html:
    cmd: python scripts/absa/make_product_cards_html.py
    deps:
    - path: data/cache/product_images/thumbs
      hash: md5
      md5: b08087d51f743fa90114eb1c1d5ceba6.dir
      size: 598684
      nfiles: 150
    - path: reports/absa/cards/product_cards_with_images.jsonl
      hash: md5
      md5: bc2164b00c5d31b5ce9f0674171c961f
      size: 1231764
    - path: scripts/absa/make_product_cards_html.py
      hash: md5
      md5: c4313a710324e81f49afe427b9710e94
      size: 18817
    outs:
    - path: reports/absa/cards/product_cards.html
      hash: md5
      md5: a4a40c667c494512f76221560aec6796
      size: 9974312
  fetch_product_images:
    cmd: python scripts/absa/fetch_product_images.py --params params.yaml
    deps:
    - path: params.yaml
      hash: md5
      md5: 00a546fbc9a54469af43a6b7ddbe0084
      size: 13034
    - path: reports/absa/cards/product_cards.jsonl
      hash: md5
      md5: cd3a89c5824c8916e2da266f4a83a968
      size: 1196215
    - path: scripts/absa/fetch_product_images.py
      hash: md5
      md5: c6e8b5abaee32ef350706df575c17c38
      size: 9830
    outs:
    - path: reports/absa/cards/product_cards_with_images.jsonl
      hash: md5
      md5: bc2164b00c5d31b5ce9f0674171c961f
      size: 1231764
    - path: reports/absa/images/product_images.csv
      hash: md5
      md5: d21f04d1fe55587c920c98b5372b2c91
      size: 36605
  download_product_thumbs:
    cmd: python scripts/absa/download_product_thumbs.py
    deps:
    - path: reports/absa/cards/product_cards_with_images.jsonl
      hash: md5
      md5: bc2164b00c5d31b5ce9f0674171c961f
      size: 1231764
    - path: scripts/absa/download_product_thumbs.py
      hash: md5
      md5: 64b48aa73ecf3ef9d855cfb200b2fa9b
      size: 8651
    outs:
    - path: data/cache/product_images/thumbs
      hash: md5
      md5: b08087d51f743fa90114eb1c1d5ceba6.dir
      size: 598684
      nfiles: 150
    - path: reports/absa/images/product_thumbs.csv
      hash: md5
      md5: e775f0d79e200eb8203edfcb14135227
      size: 166082
  compute_product_rating_stats:
    cmd: "python scripts/absa/compute_product_rating_stats.py --input_delta data/trusted/reviews_product_info_clean_full
      --id-col product_id --rating-col rating --text-col review_text_clean --out reports/absa/product_rating_stats.parquet\n"
    deps:
    - path: data/trusted/reviews_product_info_clean_full
      hash: md5
      md5: c6ac4ed4b43b109b205b6a4909967bb2.dir
      size: 796564328
      nfiles: 20
    - path: scripts/absa/compute_product_rating_stats.py
      hash: md5
      md5: 3e02262467c5ba942a5070bf0a36e981
      size: 2276
    outs:
    - path: reports/absa/product_rating_stats.parquet
      hash: md5
      md5: 09a9a32979af86f6d407349860bd8688.dir
      size: 47350
      nfiles: 4
  inject_recalculated_ratings:
    cmd: "python scripts/absa/inject_recalculated_ratings.py --cards-in reports/absa/cards/product_cards_with_images.jsonl
      --stats-parquet reports/absa/product_rating_stats.parquet --cards-out reports/absa/cards/product_cards_with_images.recalc.jsonl\n"
    deps:
    - path: reports/absa/cards/product_cards_with_images.jsonl
      hash: md5
      md5: bc2164b00c5d31b5ce9f0674171c961f
      size: 1231764
    - path: reports/absa/product_rating_stats.parquet
      hash: md5
      md5: 09a9a32979af86f6d407349860bd8688.dir
      size: 47350
      nfiles: 4
    - path: scripts/absa/inject_recalculated_ratings.py
      hash: md5
      md5: a71960a949209ea07f5f4862594b2be2
      size: 1462
    outs:
    - path: reports/absa/cards/product_cards_with_images.recalc.jsonl
      hash: md5
      md5: d8cca87672d9de71a12603f1a4925344
      size: 1427724
  make_product_cards_html_recalc:
    cmd: "python scripts/absa/make_product_cards_html.py --params params.yaml --input_jsonl
      reports/absa/cards/product_cards_with_images.recalc.jsonl --output_html reports/absa/cards/product_cards_recalc.html
      --thumbs_dir data/cache/product_images/thumbs\n"
    deps:
    - path: params.yaml
      hash: md5
      md5: 00a546fbc9a54469af43a6b7ddbe0084
      size: 13034
    - path: reports/absa/cards/product_cards_with_images.recalc.jsonl
      hash: md5
      md5: d8cca87672d9de71a12603f1a4925344
      size: 1427724
    - path: scripts/absa/make_product_cards_html.py
      hash: md5
      md5: c4313a710324e81f49afe427b9710e94
      size: 18817
    outs:
    - path: reports/absa/cards/product_cards_recalc.html
      hash: md5
      md5: 9793df43c0acf30dd18922d5ddda6b16
      size: 9974319
  build_preview_fused:
    cmd: "python scripts/absa/build_preview_fused.py --reviews_delta data/trusted/reviews_product_info_clean_full
      --ate_mapped_parquet reports/absa/ate_spans_mapped.parquet --ate_spans_parquet
      reports/absa/ate_spans.parquet --sentiment_parquet reports/albert_sample_30pct/infer_full_pandas/predictions.parquet
      --output_parquet reports/absa/preview/preview_fused.parquet --coalesce 1 --limit_show
      10\n"
    deps:
    - path: data/trusted/reviews_product_info_clean_full
      hash: md5
      md5: c6ac4ed4b43b109b205b6a4909967bb2.dir
      size: 796564328
      nfiles: 20
    - path: reports/absa/ate_spans.parquet
      hash: md5
      md5: 4102d4e746233cfa29e51819893a20ce
      size: 40073891
    - path: reports/absa/ate_spans_mapped.parquet
      hash: md5
      md5: 53b4c7b4d15c1d370e2d71b565d1fdb6
      size: 35708424
    - path: reports/albert_sample_30pct/infer_full_pandas/predictions.parquet
      hash: md5
      md5: 76cac934368a101c694d099517b5c1fd
      size: 57378857
    - path: scripts/absa/build_preview_fused.py
      hash: md5
      md5: 9c8f2b2233483f5fb6db750cd0d393e0
      size: 9059
    outs:
    - path: reports/absa/preview/preview_fused.parquet
      hash: md5
      md5: d0d8c7c002bde7668d9ba1454aaaf025.dir
      size: 246996493
      nfiles: 4
  viz_ridge_from_preview:
    cmd: "python scripts/viz/viz_ridge_from_preview.py --input_parquet reports/absa/final_all/preview_fused.parquet
      --output_html reports/viz/ridge_by_aspect_brand.html --metric rating --category_filter
      __ALL__ --top_n_brands 6 --min_n_per_cell 50 --max_aspects 8 --max_rows 1000000
      --width 800 --height_per_aspect 90\n"
    deps:
    - path: params.yaml
      hash: md5
      md5: 7e0df93ed4741e241b074c5608e43202
      size: 9285
    - path: reports/absa/final_all/preview_fused.parquet
      hash: md5
      md5: 93587eb2fe02c97ae6880df8c32659bd.dir
      size: 247000581
      nfiles: 4
    - path: scripts/viz/viz_ridge_from_preview.py
      hash: md5
      md5: 9cbc4dd215a3fd2c3a07218319b8ed10
      size: 4881
    outs:
    - path: reports/viz/ridge_by_aspect_brand.html
      hash: md5
      md5: 82189f1171bf45dc86b74fe9e70ddc6d
      size: 61971186
  viz_box_from_preview:
    cmd: "python scripts/viz/viz_box_from_preview.py --input_parquet reports/absa/final_all/preview_fused.parquet
      --output_html reports/viz/box_by_aspect_brand.html --metric rating --category_filter
      __ALL__ --min_n_per_cell 50 --max_aspects 8 --max_rows 1000000 --pixels_per_brand
      18 --panel_height 300\n"
    deps:
    - path: reports/absa/final_all/preview_fused.parquet
      hash: md5
      md5: 4a7efb49e331f9d0fc2760679b4ded55.dir
      size: 247000581
      nfiles: 4
    - path: scripts/viz/viz_box_from_preview.py
      hash: md5
      md5: a0a54dd2542b280ad2c027ed3e023d86
      size: 4719
    outs:
    - path: reports/viz/box_by_aspect_brand.html
      hash: md5
      md5: 78762790bc7694b58bb55d6f87eb3160
      size: 838884759
  compute_top_brand_per_aspect_from_preview:
    cmd: "python scripts/viz/compute_top_brand_per_aspect_from_preview.py --input_parquet
      reports/absa/final_all/preview_fused.parquet --output_csv reports/viz/top_brand_per_category_aspect.csv
      --metric rating --min_n_per_cell 50\n"
    deps:
    - path: params.yaml
      hash: md5
      md5: 9d988b0b5c3f3012c522f5c58241ae9f
      size: 9277
    - path: reports/absa/final_all/preview_fused.parquet
      hash: md5
      md5: 93587eb2fe02c97ae6880df8c32659bd.dir
      size: 247000581
      nfiles: 4
    - path: scripts/viz/compute_top_brand_per_aspect_from_preview.py
      hash: md5
      md5: 25d97df060e0afbf91b789ed64bd2914
      size: 2184
    outs:
    - path: reports/viz/top_brand_per_category_aspect.csv
      hash: md5
      md5: 43af03974dbfe83ab11d037ddf10d86f
      size: 451
  aspect_opportunity:
    cmd: "python scripts/viz/aspect_opportunity.py --preview_parquet reports/absa/final_all/preview_fused.parquet
      --products_parquet data/exploitation/product_info_snapshot.parquet --reviews_delta
      data/trusted/reviews_product_info_clean_full --out_dir reports/viz --bubble_html
      reports/viz/aspect_opportunity_bubble.html --heatmap_html reports/viz/negatives_excess_heatmap.html
      --table_csv reports/viz/negatives_table.csv --category_filter __ALL__ --min_reviews_cell
      50 --min_volume_w 10.0 --top_aspects_bubble 6 --top_brands_heatmap 30 --weight_cap_pct
      95.0 --pixels_per_brand 18 --min_panel_width 1000\n"
    deps:
    - path: data/exploitation/product_info_snapshot.parquet
      hash: md5
      md5: 041e816f52b57790656cfb5642e5f6b2.dir
      size: 53499938
      nfiles: 48
    - path: data/trusted/reviews_product_info_clean_full
      hash: md5
      md5: 40249586ccdac4a280e3a52a0f80cb42.dir
      size: 796564328
      nfiles: 20
    - path: reports/absa/final_all/preview_fused.parquet
      hash: md5
      md5: 4a7efb49e331f9d0fc2760679b4ded55.dir
      size: 247000581
      nfiles: 4
    - path: scripts/viz/aspect_opportunity.py
      hash: md5
      md5: 0b1e4c033cfaebacc7452d15b047f0b9
      size: 17206
    outs:
    - path: reports/viz/aspect_opportunity_bubble.html
      hash: md5
      md5: 9eaf3c1e45f7eac07a74ad4c2762f052
      size: 854046
    - path: reports/viz/negatives_excess_heatmap.html
      hash: md5
      md5: 2ceccc56fd06178c8a54c0a8df719cc7
      size: 158733
    - path: reports/viz/negatives_table.csv
      hash: md5
      md5: a272bf9c03ec684343d0493b66b7e563
      size: 502744
  priority_tables_simple:
    cmd: "python scripts/viz/make_priority_tables_simple.py --input_csv reports/viz/negatives_table.csv
      --out_dir reports/viz --thr_excess_high 0.03 --thr_compl_high 0.12 --thr_compl_low
      0.08 --thr_quality_high 0.65 --min_reviews 50 --min_volume_w 10.0 --top_k_overall
      100 --top_k_per_cat 30\n"
    deps:
    - path: reports/viz/negatives_table.csv
      hash: md5
      md5: a272bf9c03ec684343d0493b66b7e563
      size: 502744
    - path: scripts/viz/make_priority_tables_simple.py
      hash: md5
      md5: 660e07b0d93e875c60e75630108b320b
      size: 3177
    outs:
    - path: reports/viz/simple_labels_all.csv
      hash: md5
      md5: 20bac40f91f314c530bb9670625b47e6
      size: 546287
    - path: reports/viz/simple_top_risks_by_category.csv
      hash: md5
      md5: a6a4801a127c41671d1eafbd523b361f
      size: 48549
    - path: reports/viz/simple_top_risks_overall.csv
      hash: md5
      md5: fe66ad16bcb2ea7be89e73d8b3f7f755
      size: 17452
    - path: reports/viz/simple_top_strengths_by_category.csv
      hash: md5
      md5: 97d022f79af6fe7e8c6f5c8ff4e7a79d
      size: 43544
    - path: reports/viz/simple_top_strengths_overall.csv
      hash: md5
      md5: 0adb4d4b53fbd115007f8e9748b87737
      size: 17469
  deep_dive_reviews:
    cmd: "python scripts/viz/deep_dive_reviews.py --preview_parquet reports/absa/final_all/preview_fused.parquet
      --top_risks_csv reports/viz/simple_top_risks_overall.csv --out_dir reports/deep_dive
      --top_cells 20 --neg_label 0 --sample_reviews_per_cell 200\n"
    deps:
    - path: reports/absa/final_all/preview_fused.parquet
      hash: md5
      md5: 4a7efb49e331f9d0fc2760679b4ded55.dir
      size: 247000581
      nfiles: 4
    - path: reports/viz/simple_top_risks_overall.csv
      hash: md5
      md5: fe66ad16bcb2ea7be89e73d8b3f7f755
      size: 17452
    - path: scripts/viz/deep_dive_reviews.py
      hash: md5
      md5: db9307d20fd928909dfc9309d2147bab
      size: 3360
    outs:
    - path: reports/deep_dive
      hash: md5
      md5: f64d90207025baf99aa1c9b00174ddfe.dir
      size: 3700
      nfiles: 60
  ingredients_differential:
    cmd: "python scripts/viz/ingredients_differential.py --products_parquet data/exploitation/product_info_snapshot.parquet
      --top_risks_csv reports/viz/simple_top_risks_overall.csv --out_dir reports/ingredients_diff
      --top_cells 20 --top_terms 40\n"
    deps:
    - path: data/exploitation/product_info_snapshot.parquet
      hash: md5
      md5: 041e816f52b57790656cfb5642e5f6b2.dir
      size: 53499938
      nfiles: 48
    - path: reports/viz/simple_top_risks_overall.csv
      hash: md5
      md5: fe66ad16bcb2ea7be89e73d8b3f7f755
      size: 17452
    - path: scripts/viz/ingredients_differential.py
      hash: md5
      md5: 633e88741ae9c93987bdd0e461096ef2
      size: 7769
    outs:
    - path: reports/ingredients_diff
      hash: md5
      md5: 2e504678b517191e82962e61d30efe4e.dir
      size: 36019
      nfiles: 13
  viz_violin_secondary_rating:
    cmd: "python scripts/viz/viz_violin_secondary_rating.py --input_parquet reports/absa/preview/preview_fused.parquet
      --output_html reports/viz/violin_secondary_rating.html --metric rating --category_filter
      __ALL__ --min_reviews_per_cat 200 --max_categories 40 --per_cat_width 900 --row_height
      120 --bandwidth 0.15 --bins 30 --dedup_reviews 1\n"
    deps:
    - path: reports/absa/preview/preview_fused.parquet
      hash: md5
      md5: d0d8c7c002bde7668d9ba1454aaaf025.dir
      size: 246996493
      nfiles: 4
    - path: scripts/viz/viz_violin_secondary_rating.py
      hash: md5
      md5: a42ec41f017eae0fc437c6f50fdf6b60
      size: 5323
    outs:
    - path: reports/viz/violin_secondary_rating.html
      hash: md5
      md5: ff4a336f02e93612158d64d760e5f968
      size: 4524
  viz_market_brand_panel:
    cmd: "python scripts/viz/viz_market_brand_panel.py --input_parquet reports/absa/preview/preview_fused.parquet
      --products_parquet data/exploitation/product_info_snapshot.parquet --reviews_delta
      data/trusted/reviews_product_info_clean_full --output_html_sticky reports/viz/market_brand_panel_sticky.html
      --metric rating --dedup_reviews true --min_reviews_per_cat 200 --max_categories
      40 --bins 300 --bandwidth auto --jitter_sigma 0.12 --market_width 320 --market_height
      340 --brand_width 140 --brand_height 120 --brand_cols 6 --top_brands_per_cat
      60\n"
    deps:
    - path: data/exploitation/product_info_snapshot.parquet
      hash: md5
      md5: 9dd1c76c0e480985bea1646c3a5f535e.dir
      size: 53499938
      nfiles: 48
    - path: data/trusted/reviews_product_info_clean_full
      hash: md5
      md5: c6ac4ed4b43b109b205b6a4909967bb2.dir
      size: 796564328
      nfiles: 20
    - path: reports/absa/preview/preview_fused.parquet
      hash: md5
      md5: d0d8c7c002bde7668d9ba1454aaaf025.dir
      size: 246996493
      nfiles: 4
    - path: scripts/viz/viz_market_brand_panel.py
      hash: md5
      md5: 80619269730787bc504c1e707844c16c
      size: 16588
    outs:
    - path: reports/viz/market_brand_panel_sticky.html
      hash: md5
      md5: 1c6059b6c1c3c4cec4f8ca4d2adca73c
      size: 23188695
  viz_market_brand_bubbles:
    cmd: "python scripts/viz/viz_market_brand_bubbles.py --input_parquet reports/absa/preview/preview_fused.parquet
      --products_parquet data/exploitation/product_info_snapshot.parquet --reviews_delta
      data/trusted/reviews_product_info_clean_full --secondary_map_parquet  --output_html
      reports/viz/market_brand_bubbles.html --dedup_reviews true --min_reviews_per_cat
      200 --max_categories 40 --weight_cap_pct 95.0 --top_products 200\n"
    deps:
    - path: data/exploitation/product_info_snapshot.parquet
      hash: md5
      md5: 9dd1c76c0e480985bea1646c3a5f535e.dir
      size: 53499938
      nfiles: 48
    - path: data/trusted/reviews_product_info_clean_full
      hash: md5
      md5: c6ac4ed4b43b109b205b6a4909967bb2.dir
      size: 796564328
      nfiles: 20
    - path: reports/absa/preview/preview_fused.parquet
      hash: md5
      md5: d0d8c7c002bde7668d9ba1454aaaf025.dir
      size: 246996493
      nfiles: 4
    - path: scripts/viz/viz_market_brand_bubbles.py
      hash: md5
      md5: af9fcd3248617da4dd3943d5760adc74
      size: 18053
    outs:
    - path: reports/viz/market_brand_bubbles.html
      hash: md5
      md5: 41ef6d7e4e85551d7dd7787ca9f08ce8
      size: 953319
  link_top10_cards:
    cmd: "python scripts/viz/link_top10_cards.py --per_category_csv reports/loves_top10/per_category_top10.csv
      --global_csv reports/loves_top10/global_top10.csv --products_parquet data/exploitation/product_info_snapshot.parquet
      --cards_dir reports/absa/cards --thumbs_dir data/cache/product_images --out_html
      reports/absa/cards/top10_index.html --card_pattern {product_id}.html\n"
    deps:
    - path: data/exploitation/product_info_snapshot.parquet
      hash: md5
      md5: 041e816f52b57790656cfb5642e5f6b2.dir
      size: 53499938
      nfiles: 48
    - path: reports/loves_top10/global_top10.csv
      hash: md5
      md5: a091a9f82e13431cdc24e37b3e9f55d0
      size: 622
    - path: reports/loves_top10/per_category_top10.csv
      hash: md5
      md5: 07d5d45574b3d076d61fa6c6f3eb0ec7
      size: 9298
    - path: scripts/viz/link_top10_cards.py
      hash: md5
      md5: a77f2547bedffb097938227ad85f3443
      size: 11369
    outs:
    - path: reports/absa/cards/top10_index.html
      hash: md5
      md5: 9cdc9a1822b0add894bf05ff4f768131
      size: 56054
  cards_index_filters:
    cmd: "python scripts/viz/cards_index_with_filters.py --products_parquet data/exploitation/product_info_snapshot.parquet
      --cards_dir reports/absa/cards --thumbs_dir data/cache/product_images --out_html
      reports/absa/cards/cards_index.html --card_pattern {product_id}.html\n"
    deps:
    - path: data/exploitation/product_info_snapshot.parquet
      hash: md5
      md5: 041e816f52b57790656cfb5642e5f6b2.dir
      size: 53499938
      nfiles: 48
    - path: scripts/viz/cards_index_with_filters.py
      hash: md5
      md5: 380242f7b4da0a4b0cef0e8cdb14dbd8
      size: 11582
    outs:
    - path: reports/absa/cards/cards_index.html
      hash: md5
      md5: 295ab61fca279de0db38e02823f1d3f4
      size: 471455
  cards_index_filters_recalc_wfilters:
    cmd: "python scripts/viz/cards_index_with_filters.py --products_parquet data/exploitation/product_info_snapshot.parquet
      --cards_dir reports/absa/cards --thumbs_dir data/cache/product_images --out_html
      reports/absa/cards/product_cards_recalc_wfilters.html --card_pattern {product_id}.html\n"
    deps:
    - path: data/exploitation/product_info_snapshot.parquet
      hash: md5
      md5: 041e816f52b57790656cfb5642e5f6b2.dir
      size: 53499938
      nfiles: 48
    - path: scripts/viz/cards_index_with_filters.py
      hash: md5
      md5: 380242f7b4da0a4b0cef0e8cdb14dbd8
      size: 11582
    outs:
    - path: reports/absa/cards/product_cards_recalc_wfilters.html
      hash: md5
      md5: 295ab61fca279de0db38e02823f1d3f4
      size: 471455
  volumetria_lake:
    cmd: "python scripts/EDA/volumetria_lake.py --roots data/landing data/trusted
      data/exploitation --outdir reports/volumetria --fix-nanos --inplace\n"
    deps:
    - path: data/exploitation
      hash: md5
      md5: 553b00711b1e0ef5efc6231c6e35d029.dir
      size: 1539661752
      nfiles: 78
    - path: data/landing
      hash: md5
      md5: e01b9a8434d07d705d6a8169c8d58e95.dir
      size: 769381858
      nfiles: 243
    - path: data/trusted
      hash: md5
      md5: 9589ca45434485d89b6ee51e41e17ea3.dir
      size: 2718170589
      nfiles: 521
    - path: scripts/EDA/volumetria_lake.py
      hash: md5
      md5: 6b2b7693950da6de06dce69ca4ab3e92
      size: 8485
    outs:
    - path: reports/volumetria
      hash: md5
      md5: 0cedbe4be4c8f12876a58f93853fc241.dir
      size: 84326
      nfiles: 2
  eda_landing:
    cmd: "python scripts/EDA/eda_landing.py --input 'data/landing/*/raw/*.csv' --kind
      csv --outdir reports/eda/landing\n"
    deps:
    - path: data/landing/sephora/raw
      hash: md5
      md5: 8b7019941c39ea0d57fae739d69994b5.dir
      size: 528949733
      nfiles: 6
    - path: data/landing/ulta/raw
      hash: md5
      md5: 4801b579aff96d61657360644b9bd6ad.dir
      size: 1417818
      nfiles: 1
    - path: scripts/EDA/eda_landing.py
      hash: md5
      md5: 92adddefb8e8e2c8746c8283207c0681
      size: 3486
    outs:
    - path: reports/eda/landing
      hash: md5
      md5: 0155e7d5bbc9d3e28fd147bea30a7e9d.dir
      size: 3369
      nfiles: 9
  eda_landing_all:
    cmd: "python scripts/EDA/eda_landing.py --mode landing_all\n"
    deps:
    - path: data/landing/sephora/raw
      hash: md5
      md5: 8b7019941c39ea0d57fae739d69994b5.dir
      size: 528949733
      nfiles: 6
    - path: data/landing/ulta/raw
      hash: md5
      md5: 4801b579aff96d61657360644b9bd6ad.dir
      size: 1417818
      nfiles: 1
    - path: scripts/EDA/eda_landing.py
      hash: md5
      md5: 4318c420ebd3af2870adf660f06cc133
      size: 5195
    outs:
    - path: reports/eda/landing_sephora_products
      hash: md5
      md5: f12f0dc9d5a463d28bbf8f848678f21a.dir
      size: 13501
      nfiles: 90
    - path: reports/eda/landing_sephora_reviews
      hash: md5
      md5: 36d580d2531d9d55571a04fbc4f75baa.dir
      size: 9278
      nfiles: 86
    - path: reports/eda/landing_ulta_reviews
      hash: md5
      md5: 8384a2036273bd5abbee8f96453dc897.dir
      size: 10442
      nfiles: 50
  eda_trusted_all:
    cmd: "python scripts/EDA/eda_trusted.py --mode trusted_all\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 5269b492d98c898e54fa130f8855e3a8.dir
      size: 495378510
      nfiles: 18
    - path: data/trusted/reviews_product_info_clean_full
      hash: md5
      md5: c6ac4ed4b43b109b205b6a4909967bb2.dir
      size: 796564328
      nfiles: 20
    - path: data/trusted/reviews_sample_30pct
      hash: md5
      md5: 353a151684796b369a4e95a3ae6d7649.dir
      size: 152013041
      nfiles: 130
    - path: scripts/EDA/eda_trusted.py
      hash: md5
      md5: 99b7abdaecbaf84ea1667966a45064e4
      size: 10029
    outs:
    - path: reports/eda/trusted_reviews_full
      hash: md5
      md5: deef46a0a0e655dbf9b0607edd80a543.dir
      size: 20670
      nfiles: 94
    - path: reports/eda/trusted_reviews_product_info_clean_full
      hash: md5
      md5: ccef6d33d059e545d04028f4db61e3dc.dir
      size: 44016
      nfiles: 194
    - path: reports/eda/trusted_reviews_sample_30pct
      hash: md5
      md5: ab7ccf9c057f22343b67796f299e1965.dir
      size: 34479
      nfiles: 98
  eda_exploitation_all:
    cmd: "python scripts/EDA/eda_exploitation.py --mode exploitation_all\n"
    deps:
    - path: data/exploitation/product_info_snapshot.parquet
      hash: md5
      md5: 9dd1c76c0e480985bea1646c3a5f535e.dir
      size: 53499938
      nfiles: 48
    - path: scripts/EDA/eda_exploitation.py
      hash: md5
      md5: e9232bf5ed9fe29b11b1f6a795c51093
      size: 7878
    outs:
    - path: reports/eda/exploitation_product_info_snapshot
      hash: md5
      md5: ccd90f644ed148c66c8f2455a65b581b.dir
      size: 5125
      nfiles: 46
  eval_confusion_matrices:
    cmd: "python scripts/training/eval_confusion_matrices.py\n"
    deps:
    - path: data/exploitation/modelos_input/sample_tvt/test
      hash: md5
      md5: 989635988cbce1bae11cbb4347855038.dir
      size: 21386747
      nfiles: 1
    - path: reports/albert_sample_30pct/infer_full_pandas/predictions.parquet
      hash: md5
      md5: 76cac934368a101c694d099517b5c1fd
      size: 57378857
    - path: reports/sentiment_rf_sample/eval/test_predictions.parquet
      hash: md5
      md5: 9e1bc5f14e2b599718649443c65e74c7
      size: 1964922
    - path: scripts/training/eval_confusion_matrices.py
      hash: md5
      md5: 2516dd531e80056d124f29da128c2a67
      size: 9272
    outs:
    - path: reports/eval/confusion_matrices/
      hash: md5
      md5: 44962a149fcb4ab115400d3ff369e794.dir
      size: 1434
      nfiles: 6
  train_svm:
    cmd: "python scripts/training/train_svm.py --train data/exploitation/modelos_input/sample_tvt/train
      --val   data/exploitation/modelos_input/sample_tvt/val --model-out models/sentiment_svm_sample\n"
    deps:
    - path: data/exploitation/modelos_input/sample_tvt/train
      hash: md5
      md5: 66a0af1b68d9c71fb2a21d901b06d949.dir
      size: 105974196
      nfiles: 1
    - path: data/exploitation/modelos_input/sample_tvt/val
      hash: md5
      md5: 438f5cc77205c58ae0825afb075d9be6.dir
      size: 14251404
      nfiles: 1
    - path: scripts/training/train_svm.py
      hash: md5
      md5: 073ca937c0b0479aa74d2cfe185a4a84
      size: 10725
    outs:
    - path: models/sentiment_svm_sample
      hash: md5
      md5: 9ecde76360b4d13c4ec1f893da137492.dir
      size: 18677894
      nfiles: 3
  evaluate_svm:
    cmd: "python scripts/training/infer_svm.py --model-dir models/sentiment_svm_sample
      --input data/exploitation/modelos_input/sample_tvt/test --output-dir reports/sentiment_svm_sample/eval
      --text-col review_text --id-col review_id\n"
    deps:
    - path: data/exploitation/modelos_input/sample_tvt/test
      hash: md5
      md5: 989635988cbce1bae11cbb4347855038.dir
      size: 21386747
      nfiles: 1
    - path: models/sentiment_svm_sample
      hash: md5
      md5: 9ecde76360b4d13c4ec1f893da137492.dir
      size: 18677894
      nfiles: 3
    - path: scripts/training/infer_svm.py
      hash: md5
      md5: d27f85d544d4fa28c455edc2d1b3c6c0
      size: 6867
    outs:
    - path: reports/sentiment_svm_sample/eval
      hash: md5
      md5: c4090a47efba1af5c19b301287402102.dir
      size: 1952705
      nfiles: 1
