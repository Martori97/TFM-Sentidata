schema: '2.0'
stages:
  ingest_kaggle:
    cmd: python scripts/data_ingestion/descarga_kaggle_reviews.py --out 
      data/landing/sephora/raw
    deps:
    - path: scripts/data_ingestion/descarga_kaggle_reviews.py
      hash: md5
      md5: e27b06cc672ef4f0b2347bf61ccb6322
      size: 762
    outs:
    - path: data/landing/sephora/raw
      hash: md5
      md5: 8b7019941c39ea0d57fae739d69994b5.dir
      size: 528949733
      nfiles: 6
  conversion_a_delta:
    cmd: python scripts/data_cleaning/conversion_a_delta.py --input 
      data/landing/sephora/raw --output data/landing/sephora/delta
    deps:
    - path: data/landing/sephora/raw
      hash: md5
      md5: 8b7019941c39ea0d57fae739d69994b5.dir
      size: 528949733
      nfiles: 6
    - path: scripts/data_cleaning/conversion_a_delta.py
      hash: md5
      md5: c3a4ec2564051338d2f39b94ceff02c7
      size: 2042
    outs:
    - path: data/landing/sephora/delta
      hash: md5
      md5: 43602db7033498987b0b086124f5b1ab.dir
      size: 230119217
      nfiles: 172
  trusted_clean_driver:
    cmd: python scripts/data_cleaning/trusted_clean_driver.py --input 
      data/landing/sephora/delta --output data/trusted/sephora_clean
    deps:
    - path: data/landing/sephora/delta
      hash: md5
      md5: 43602db7033498987b0b086124f5b1ab.dir
      size: 230119217
      nfiles: 172
    - path: scripts/data_cleaning/trusted_clean_driver.py
      hash: md5
      md5: a3e2446b4dff6056698cb1cf625de1e1
      size: 838
    - path: scripts/data_cleaning/trusted_clean_single.py
      hash: md5
      md5: e9f9c94752272c42f4c257b369e68e8b
      size: 4336
    outs:
    - path: data/trusted/sephora_clean
      hash: md5
      md5: db2adc72b69dc26ba5a013e2ecd9e867.dir
      size: 500884662
      nfiles: 250
  merge_trusted_reviews:
    cmd: python scripts/data_cleaning/merge_trusted_reviews.py --input-dir 
      data/trusted/sephora_clean --output data/trusted/reviews_full
    deps:
    - path: data/trusted/sephora_clean
      hash: md5
      md5: db2adc72b69dc26ba5a013e2ecd9e867.dir
      size: 500884662
      nfiles: 250
    - path: scripts/data_cleaning/merge_trusted_reviews.py
      hash: md5
      md5: 451be47cd2deaffc43e011a63e87b999
      size: 1948
    outs:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 08549c8975b204736b6d85c1bb6a55a8.dir
      size: 493840996
      nfiles: 18
  eda_full:
    cmd: python scripts/EDA/eda_reviews.py --input data/trusted/reviews_full 
      --outdir reports/eda/full --tokenizer albert-base-v2
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 08549c8975b204736b6d85c1bb6a55a8.dir
      size: 493840996
      nfiles: 18
    - path: params.yaml
      hash: md5
      md5: 1cc224cc01c4ed14dd211f948a3e9977
      size: 1052
    - path: scripts/EDA/eda_reviews.py
      hash: md5
      md5: 6235ecad747eb664623c25c539bb2a67
      size: 10430
    outs:
    - path: reports/eda/full
      hash: md5
      md5: 7bf3ddaa898dd7f5fd79c27084c2c550.dir
      size: 91160
      nfiles: 10
  sample_reviews:
    cmd: "python scripts/data_cleaning/sample_reviews.py --input data/trusted/reviews_full
      --output data/trusted/reviews_sample_30pct --frac 0.30 --by labels --seed 42\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 08549c8975b204736b6d85c1bb6a55a8.dir
      size: 493840996
      nfiles: 18
    - path: scripts/data_cleaning/sample_reviews.py
      hash: md5
      md5: b53be00c693d1b0eca07a1c53acbfe64
      size: 3658
    outs:
    - path: data/trusted/reviews_sample_30pct
      hash: md5
      md5: 2f4abe9eececec8710ea87937d163ea7.dir
      size: 148792281
      nfiles: 18
  eda_sample:
    cmd: python scripts/EDA/eda_reviews.py --input 
      data/trusted/reviews_sample_30pct --outdir reports/eda/sample_30pct 
      --tokenizer albert-base-v2
    deps:
    - path: data/trusted/reviews_sample_30pct
      hash: md5
      md5: 2f4abe9eececec8710ea87937d163ea7.dir
      size: 148792281
      nfiles: 18
    - path: params.yaml
      hash: md5
      md5: 1cc224cc01c4ed14dd211f948a3e9977
      size: 1052
    - path: scripts/EDA/eda_reviews.py
      hash: md5
      md5: 6235ecad747eb664623c25c539bb2a67
      size: 10430
    outs:
    - path: reports/eda/sample_30pct
      hash: md5
      md5: f00407d91fdf27502b34286c503e82a3.dir
      size: 88768
      nfiles: 10
  eda_compare_full_vs_sample_30pct:
    cmd: python scripts/EDA/eda_compare.py --full reports/eda/full --sample 
      reports/eda/sample_30pct --outdir reports/eda/compare_full_vs_sample_30pct
    deps:
    - path: reports/eda/full
      hash: md5
      md5: 7bf3ddaa898dd7f5fd79c27084c2c550.dir
      size: 91160
      nfiles: 10
    - path: reports/eda/sample_30pct
      hash: md5
      md5: f00407d91fdf27502b34286c503e82a3.dir
      size: 88768
      nfiles: 10
    - path: scripts/EDA/eda_compare.py
      hash: md5
      md5: ccbfd0ac430439ce9b8480693f4f6702
      size: 6597
    outs:
    - path: reports/eda/compare_full_vs_sample_30pct
      hash: md5
      md5: ac22c9f240eab39a98b6d5ffa5db78a9.dir
      size: 6506
      nfiles: 7
  split_train_val_test:
    cmd: "python scripts/training/split_train_val_test.py --input  data/trusted/reviews_sample_30pct
      --outdir data/trusted/splits --text-col review_text_clean --val-size 0.15 --test-size
      0.15 --seed 42\n"
    deps:
    - path: data/trusted/reviews_sample_30pct
      hash: md5
      md5: 2f4abe9eececec8710ea87937d163ea7.dir
      size: 148792281
      nfiles: 18
    - path: params.yaml
      hash: md5
      md5: fdb4f363dba88772bc9f992f07b6c364
      size: 1540
    - path: scripts/training/split_train_val_test.py
      hash: md5
      md5: 19e94c622f966604acabd44418aae734
      size: 4336
    outs:
    - path: data/trusted/splits/test
      hash: md5
      md5: 8a1def0b2bcd7cd82a5bff495afde1e1.dir
      size: 22683959
      nfiles: 14
    - path: data/trusted/splits/train
      hash: md5
      md5: da6ac01cead9a132819ad7cdd9d53157.dir
      size: 104137336
      nfiles: 14
    - path: data/trusted/splits/val
      hash: md5
      md5: 9f75b5244b8f0c37b93e9953a22c453d.dir
      size: 22711700
      nfiles: 14
  train_albert_sample:
    cmd: "MLFLOW_RUN_NAME=albert_sample_30pct python scripts/training/train_albert_from_parquets.py
      --train data/exploitation/modelos_input/sample_tvt/train --val   data/exploitation/modelos_input/sample_tvt/val
      --model-out models/albert_sample_30pct --params params.yaml\n"
    deps:
    - path: data/exploitation/modelos_input/sample_tvt/train
      hash: md5
      md5: 7cd73ea1291404d41796bff9a9903688.dir
      size: 111804078
      nfiles: 1
    - path: data/exploitation/modelos_input/sample_tvt/val
      hash: md5
      md5: 1a7dde8360bfec37f8e3438a8eba43fa.dir
      size: 15074562
      nfiles: 1
    - path: params.yaml
      hash: md5
      md5: 57681352881139abfa0a2b1195ab4113
      size: 1184
    - path: scripts/training/train_albert_from_parquets.py
      hash: md5
      md5: f17b0ccf01dc7be6e24ce6fb5b3ee8d8
      size: 22893
    outs:
    - path: models/albert_sample_30pct
      hash: md5
      md5: 9213ed28d73f5937d1cb02afb1abe741.dir
      size: 336419748
      nfiles: 29
  evaluate_albert_sample:
    cmd: "python scripts/training/evaluate_albert.py --model_dir models/albert_sample_30pct/frozen
      --test_parquet data/trusted/splits/test --output_dir reports/albert_sample_30pct/eval\n"
    deps:
    - path: data/trusted/splits/test
      hash: md5
      md5: 8a1def0b2bcd7cd82a5bff495afde1e1.dir
      size: 22683959
      nfiles: 14
    - path: models/albert_sample_30pct/frozen
      hash: md5
      md5: fcd91fc1d9ce8e2223e1ea146b83b418.dir
      size: 49782116
      nfiles: 6
    - path: params.yaml
      hash: md5
      md5: 6b4d463518654d141c6a2bf63f0433d4
      size: 1541
    - path: scripts/training/evaluate_albert.py
      hash: md5
      md5: fcf09ac1e265bcfdc60b14702bb27e84
      size: 7916
    outs:
    - path: reports/albert_sample_30pct/eval
      hash: md5
      md5: 0a7fcb7213348315e042fa4195dc7d5a.dir
      size: 1070
      nfiles: 2
  train_albert:
    cmd: "python scripts/training/train_albert_from_parquets.py --train data/trusted/splits/train
      --val   data/trusted/splits/val --model-out models/albert_sample_30pct --params
      params.yaml\n"
    deps:
    - path: data/trusted/splits/train
      hash: md5
      md5: da6ac01cead9a132819ad7cdd9d53157.dir
      size: 104137336
      nfiles: 14
    - path: data/trusted/splits/val
      hash: md5
      md5: 9f75b5244b8f0c37b93e9953a22c453d.dir
      size: 22711700
      nfiles: 14
    - path: params.yaml
      hash: md5
      md5: 6b4d463518654d141c6a2bf63f0433d4
      size: 1541
    - path: scripts/training/train_albert_from_parquets.py
      hash: md5
      md5: 26a546ff762a2c400ba78a867913b983
      size: 22305
    outs:
    - path: models/albert_sample_30pct
      hash: md5
      md5: a934c04bc2d811fb9de192081d42f3cf.dir
      size: 386201868
      nfiles: 35
  infer_albert_all:
    cmd: "python scripts/training/infer_albert_all.py --model_dir models/albert_sample_30pct/frozen
      --input_parquet data/trusted/reviews_full --output_parquet reports/albert_sample_30pct/infer/predictions.parquet
      --eval_output_dir reports/albert_sample_30pct/infer_eval_full\n"
    deps:
    - path: data/trusted/reviews_full
      hash: md5
      md5: 08549c8975b204736b6d85c1bb6a55a8.dir
      size: 493840996
      nfiles: 18
    - path: models/albert_sample_30pct/frozen
      hash: md5
      md5: fcd91fc1d9ce8e2223e1ea146b83b418.dir
      size: 49782116
      nfiles: 6
    - path: params.yaml
      hash: md5
      md5: 8ab56ab9ffeffd775bc528d68fc4c04e
      size: 2069
    - path: scripts/training/infer_albert_all.py
      hash: md5
      md5: 830cad9b94241c4879919aeda682820e
      size: 9234
    outs:
    - path: reports/albert_sample_30pct/infer
      hash: md5
      md5: 848db68ae73a41f20d212f2dfa96ecc4.dir
      size: 44334962
      nfiles: 1
    - path: reports/albert_sample_30pct/infer_eval_full
      hash: md5
      md5: f3a267c30183672f397ef4a9b9735fa0.dir
      size: 141
      nfiles: 2
